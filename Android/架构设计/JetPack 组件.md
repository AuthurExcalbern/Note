### å‰è¨€

**Android Jetpack**æƒ³å¿…å¤§å®¶éƒ½è€³ç†Ÿèƒ½è¯¦äº†ï¼Œ`Android KTX`ï¼Œ`LiveData`ï¼Œ`Room`ç­‰ç­‰ä¸€ç³»åˆ—åº“éƒ½æ˜¯å‡ºè‡ª `Jetpack`ã€‚é‚£ä¹ˆ`Jetpack`åˆ°åº•æ˜¯ä»€ä¹ˆï¼ŸåˆåŒ…å«å“ªäº›ä½ è¿˜æ²¡ç”¨è¿‡çš„ä¸œè¥¿ï¼Ÿ`Google`æ¨å‡ºè¿™ä¸ªçš„åŸå› åˆæ˜¯ä»€ä¹ˆï¼Ÿä»Šå¤©æˆ‘ä»¬å°±ä¸€èµ·æ¥å®Œå–„ä¸€ä¸‹æˆ‘ä»¬è„‘ä¸­çš„`Jetpackæ„å›¾`ã€‚ï¼ˆç¯‡å¹…è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµå…³æ³¨Markå“¦ğŸ¶ ï¼‰

### ä»‹ç»

2018å¹´è°·æ­ŒI/Oï¼Œ`Jetpack`æ¨ªç©ºå‡ºä¸–ï¼Œå®˜æ–¹ä»‹ç»å¦‚ä¸‹ï¼š

> Jetpack æ˜¯ä¸€å¥—åº“ã€å·¥å…·å’ŒæŒ‡å—ï¼Œå¯å¸®åŠ©å¼€å‘è€…æ›´è½»æ¾åœ°ç¼–å†™ä¼˜è´¨åº”ç”¨ã€‚è¿™äº›ç»„ä»¶å¯å¸®åŠ©æ‚¨éµå¾ªæœ€ä½³åšæ³•ã€è®©æ‚¨æ‘†è„±ç¼–å†™æ ·æ¿ä»£ç çš„å·¥ä½œå¹¶ç®€åŒ–å¤æ‚ä»»åŠ¡ï¼Œä»¥ä¾¿æ‚¨å°†ç²¾åŠ›é›†ä¸­æ”¾åœ¨æ‰€éœ€çš„ä»£ç ä¸Šã€‚

å¥½å¥½ç¢ç£¨è¿™æ®µä»‹ç»å°±èƒ½è§£é‡Šæˆ‘ä»¬åˆšæ‰çš„é—®é¢˜ã€‚

`Jetpack`åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ

- æ˜¯ä¸€å¥—åº“ã€å·¥å…·å’ŒæŒ‡å—ã€‚è¯´ç™½äº†å°±æ˜¯ä¸€ç³»åˆ—çš„åº“æˆ–è€…å·¥å…·é›†åˆï¼Œè€Œä¸”è¿™äº›å·¥å…·æ˜¯ä½œä¸ºæˆ‘ä»¬ä¼˜è´¨åº”ç”¨çš„æŒ‡å—ï¼Œç›¸å½“äº`å®˜æ–¹æ¨è`åšæ³•ã€‚

`google`æ¨å‡ºè¿™ä¸ªç³»åˆ—çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ

- è§„èŒƒå¼€å‘è€…æ›´å¿«æ›´å¥½çš„å¼€å‘å‡ºä¼˜è´¨åº”ç”¨ã€‚ä¸€ç›´ä»¥æ¥ï¼Œ`Androidå¼€å‘`éƒ½å……æ–¥äº†å¤§é‡çš„ä¸è§„èŒƒçš„æ“ä½œå’Œé‡å¤ä»£ç ï¼Œæ¯”å¦‚ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œå¼€å‘è¿‡ç¨‹çš„é‡å¤ï¼Œé¡¹ç›®æ¶æ„çš„é€‰æ‹©ç­‰ç­‰ã€‚æ‰€ä»¥`Google`ä¸ºäº†è§„èŒƒå¼€å‘è¡Œä¸ºï¼Œå°±æ¨å‡ºè¿™å¥—æŒ‡å—ï¼Œæ—¨åœ¨è®©å¼€å‘è€…ä»¬èƒ½å¤Ÿ`æ›´å¥½ï¼Œæ›´å¿«ï¼Œæ›´è§„èŒƒ`åœ°å¼€å‘å‡ºä¼˜è´¨åº”ç”¨ã€‚

å½“ç„¶ï¼Œè¿™ä¸¤å¹´çš„å®è·µä¹Ÿç¡®å®è¯æ˜äº†`Jetpack`åšåˆ°äº†å®ƒä»‹ç»çš„é‚£æ ·ï¼Œä¾¿æ·ï¼Œå¿«é€Ÿï¼Œä¼˜è´¨ã€‚æ‰€ä»¥æˆ‘ä»¬ä½œä¸ºå¼€å‘è€…è¿˜æ˜¯åº”è¯¥æ—©ç‚¹åº”ç”¨åˆ°è¿™äº›å·¥å…·ï¼Œæé«˜è‡ªå·±çš„`å¼€å‘æ•ˆç‡`ï¼Œä¹Ÿè§„èŒƒæˆ‘ä»¬è‡ªå·±çš„å¼€å‘è¡Œä¸ºã€‚ä¸‹é¢æˆ‘ä»¬å°±ä¸€èµ·äº†è§£ä¸‹`Jetpack`çš„æ‰€æœ‰å·¥å…·æŒ‡å—ã€‚GOGOGOï¼

å…ˆæ¥ä¸€å¼ å®˜ç½‘çš„æ€»æ½å›¾ï¼š
 (`æ¸©é¦¨æç¤ºâ¤ï¸`æœ¬æ–‡ä¸¥æ ¼æŒ‰ç…§ä¸‹å›¾é¡ºåºå¯¹ç»„ä»¶è¿›è¡Œåˆ†æï¼Œæœ‰éœ€è¦çš„å¯ä»¥ä»ç›®å½•è¿›å…¥æˆ–è€…ç›´æ¥æœç´¢æŸ¥çœ‹)

![img](https:////upload-images.jianshu.io/upload_images/8690467-1add68bbed059d2d.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

Jetpack.jpg

### Jetpack-åŸºç¡€ç»„ä»¶

#### Android KTX

> Android KTX æ˜¯åŒ…å«åœ¨ Android Jetpack åŠå…¶ä»– Android åº“ä¸­çš„ä¸€ç»„ Kotlin æ‰©å±•ç¨‹åºã€‚KTX æ‰©å±•ç¨‹åºå¯ä»¥ä¸º Jetpackã€Android å¹³å°åŠå…¶ä»– API æä¾›ç®€æ´çš„æƒ¯ç”¨ Kotlin ä»£ç ã€‚ä¸ºæ­¤ï¼Œè¿™äº›æ‰©å±•ç¨‹åºåˆ©ç”¨äº†å¤šç§ Kotlin è¯­è¨€åŠŸèƒ½

æ‰€ä»¥`Android KTX`å°±æ˜¯åŸºäº`kotlin`ç‰¹æ€§è€Œæ‰©å±•çš„ä¸€äº›åº“ï¼Œæ–¹ä¾¿å¼€å‘ä½¿ç”¨ã€‚

ä¸¾ğŸŒ°ï¼š
 ç°åœ¨æœ‰ä¸ªéœ€æ±‚ï¼Œè®©ä¸¤ä¸ª`Setæ•°ç»„`çš„æ•°æ®ç›¸åŠ ï¼Œèµ‹å€¼ç»™æ–°çš„`Setæ•°ç»„`ã€‚æ­£å¸¸æƒ…å†µä¸‹å®ç°åŠŸèƒ½ï¼š



```kotlin
    val arraySet1 = LinkedHashSet<Int>()
    arraySet1.add(1)
    arraySet1.add(2)
    arraySet1.add(3)

    val arraySet2 = LinkedHashSet<Int>()
    arraySet2.add(4)
    arraySet2.add(5)
    arraySet2.add(6)

    val combinedArraySet1 = LinkedHashSet<Int>()
    combinedArraySet1.addAll(arraySet1)
    combinedArraySet1.addAll(arraySet2)
```

è¿™ä»£ç çœŸæ˜¯åˆè‡­åˆé•¿ğŸ™„ï¸ï¼Œæ²¡å…³ç³»ï¼Œå¼•å…¥`Collection KTX`æ‰©å±•åº“å†å®ç°è¯•è¯•ï¼š



```kotlin
    dependencies {
        implementation "androidx.collection:collection-ktx:1.1.0"
    }
    
    // Combine 2 ArraySets into 1.
    val combinedArraySet = arraySetOf(1, 2, 3) + arraySetOf(4, 5, 6)
```

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œç”¨åˆ°`kotlin`çš„æ‰©å±•å‡½æ•°æ‰©å±•å±æ€§ï¼Œæ‰©å±•äº†é›†åˆç›¸å…³çš„åŠŸèƒ½ï¼Œç®€åŒ–äº†ä»£ç ã€‚
 ç”±äº`kotlin`çš„å„ç§ç‰¹æ€§ï¼Œä¹Ÿå°±ä¿ƒæˆäº†ä¸€ç³»åˆ—çš„æ‰©å±•åº“ï¼Œè¿˜åŒ…æ‹¬æœ‰`Fragment KTXï¼ŒLifecycle KTX`ç­‰ç­‰ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fkotlin%2Fktx)    
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fktx)

#### AppCompat

ä¸çŸ¥é“å¤§å®¶å‘ç°æ²¡ï¼ŒåŸæ¥Activityç»§æ‰¿çš„Activityç±»éƒ½è¢«è¦æ±‚æ”¹æˆç»§æ‰¿`AppCompatActivity`ç±»ã€‚è¿™ä¸ªAppCompatActivityç±»å°±å±äº`AppCompat`åº“ï¼Œä¸»è¦åŒ…å«å¯¹Material Designç•Œé¢å®ç°çš„æ”¯æŒï¼Œç›¸ç±»ä¼¼çš„è¿˜åŒ…æ‹¬`ActionBarï¼ŒAppCompatDialogå’ŒShareActionProvider`ï¼Œä¸€å…±å››ä¸ªå…³é”®ç±»ã€‚

é‚£ä¹ˆAppCompatActivityç±»åˆ°åº•å¯¹æ¯”Activityç±»åˆä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

- `AppCompatActivity`ï¼Œç±»ä¼¼äºåŸæ¥çš„ActionBarActivityï¼Œä¸€ä¸ªå¸¦æ ‡é¢˜æ çš„Activityã€‚å…·ä½“å°±æ˜¯å¸¦Toolbarçš„Activityã€‚

è¿™é‡Œè¿˜æœ‰ä¸ª`ShareActionProvider`å¤§å®¶å¯èƒ½ç”¨å¾—æ¯”è¾ƒå°‘ï¼Œè¿™ä¸ªç±»æ˜¯ç”¨äºåœ¨èœå•æ é›†æˆåˆ†äº«åŠŸèƒ½ã€‚
 é€šè¿‡`setShareIntent(Intent intent)`æ–¹æ³•å¯ä»¥åœ¨Menué‡Œè®¾ç½®ä½ è¦åˆ†äº«çš„å†…å®¹ã€‚å…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒ[å®˜ç½‘è¯´æ˜](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Freference%2Fandroidx%2Fappcompat%2Fwidget%2FShareActionProvider)ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Fsupport-library%2Fpackages%23v7-appcompat)

#### Auto

> è®©æ‚¨åœ¨ç¼–å†™åº”ç”¨æ—¶æ— éœ€æ‹…å¿ƒç‰¹å®šäºè½¦è¾†çš„ç¡¬ä»¶å·®å¼‚ï¼ˆå¦‚å±å¹•åˆ†è¾¨ç‡ã€è½¯ä»¶ç•Œé¢ã€æ—‹é’®å’Œè§¦æ‘¸å¼æ§ä»¶ï¼‰ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºä¸Šçš„ Android Auto åº”ç”¨è®¿é—®æ‚¨çš„åº”ç”¨ã€‚æˆ–è€…ï¼Œå½“è¿æ¥åˆ°å…¼å®¹è½¦è¾†æ—¶ï¼Œè¿è¡Œ Android 5.0ï¼ˆæˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰çš„æ‰‹æŒè®¾å¤‡ä¸Šçš„åº”ç”¨å¯ä»¥ä¸é€šè¿‡ Android Auto æŠ•å°„åˆ°è½¦è¾†çš„åº”ç”¨è¿›è¡Œé€šä¿¡ã€‚

`Android Auto`ï¼Œè¿™ä¸ªå¤§å®¶ä¼°è®¡æœ‰ç‚¹é™Œç”Ÿã€‚ä½†æ˜¯è¯´åˆ° CarPlayå¤§å®¶æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰å‘¢ï¼Ÿæ²¡é”™ï¼Œ`Android Auto`æ˜¯Googleå‡ºçš„è½¦æœºæ‰‹æœºäº’è”æ–¹æ¡ˆã€‚å›½å†…é”€å”®çš„æ±½è½¦å¤§å¤šæ•°æ²¡æœ‰æ­è½½è°·æ­Œçš„Android Autoå¢™å¤ªé«˜ï¼Œè§¦åŠä¸åˆ°ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥è§¦çš„å¾ˆå°‘ã€‚ä½†æ˜¯å›½å¤–è¿˜æ˜¯åº”ç”¨æ¯”è¾ƒå¹¿æ³›çš„ã€‚

æ‰€ä»¥è¿™ä¸€æ¨¡å—å°±æ˜¯ç”¨äºå¼€å‘`Android Auto`ç›¸å…³åº”ç”¨çš„ï¼Œæ¯”å¦‚éŸ³ä¹æ’­æ”¾APPï¼Œå³æ—¶é€šä¿¡APPä¹‹ç±»ï¼Œå¯ä»¥ä¸è½¦è½½ç³»ç»Ÿé€šä¿¡ã€‚

æ€ä¹ˆè®©ä½ çš„åº”ç”¨æ”¯æŒAndroid Autoï¼Ÿ



```java
    //æ·»åŠ 
    <meta-data android:name="com.google.android.gms.car.application"
            android:resource="@xml/automotive_app_desc"/>
            
    <automotiveApp>
        <uses name="media"/>
    </automotiveApp>        
```

ç„¶åå°±å¯ä»¥è¿›è¡Œç›¸å…³å¼€å‘äº†ã€‚æ€ä¹ˆæµ‹è¯•å‘¢ï¼Ÿæ€»ä¸èƒ½è®©æˆ‘å»æ±½è½¦é‡Œé¢æµ‹è¯•å§ã€‚ã€‚
 æ”¾å¿ƒï¼Œå®˜æ–¹æä¾›äº†æ¨¡æ‹Ÿå™¨â€”`Android Auto Desktop Head Unit emulator`ï¼ˆç®€ç§°DHUï¼‰ï¼Œåœ¨`SDK Tools`é‡Œé¢å¯ä»¥ä¸‹è½½ã€‚
 å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥å»[å®˜ç½‘æ–‡æ¡£äº†è§£æ›´å¤š](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftraining%2Fcars)ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftraining%2Fcars)

#### æ£€æµ‹

> ä½¿ç”¨ Jetpack åŸºå‡†åº“ï¼Œæ‚¨å¯ä»¥åœ¨ Android Studio ä¸­å¿«é€Ÿå¯¹ Kotlin æˆ– Java ä»£ç è¿›è¡ŒåŸºå‡†åŒ–åˆ†æã€‚è¯¥åº“ä¼šå¤„ç†é¢„çƒ­ï¼Œè¡¡é‡ä»£ç æ€§èƒ½ï¼Œå¹¶å°†åŸºå‡†åŒ–åˆ†æç»“æœè¾“å‡ºåˆ° Android Studio æ§åˆ¶å°ã€‚

è¿™ä¸ªæ¨¡å—è¯´çš„æ˜¯ä¸€ä¸ªæµ‹è¯•æ€§èƒ½çš„åº“â€”`Benchmark`ï¼Œå…¶å®å°±æ˜¯æµ‹è¯•è€—æ—¶æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨æ¥æµ‹è¯•`UIæ€§èƒ½`ï¼Œå›¾ç‰‡åŠ è½½æ€§èƒ½ç­‰ç­‰ã€‚ç°åœ¨æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªæµ‹è¯•å›¾ç‰‡åŠ è½½æ€§èƒ½çš„ğŸŒ°ï¼š

ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ç›´æ¥åˆ›å»ºä¸€ä¸ªBenchmarkæ¨¡å—ï¼Œå³é”®`New > Module >Benchmark Module`ã€‚
 è¿™æ ·å°±ä¼šå¸®æˆ‘ä»¬å¯¼å…¥å¥½åº“äº†ï¼Œç„¶åæˆ‘ä»¬åœ¨`androidTestâ€”java`ç›®å½•ä¸‹åˆ›å»ºæˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹ç±»BitmapBenchmarkï¼Œå¹¶æ·»åŠ ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹æ–¹æ³•ã€‚



```kotlin
    androidTestImplementation 'junit:junit:4.12'
    androidTestImplementation 'androidx.benchmark:benchmark-junit4:1.0.0'
    
private const val JETPACK = "images/test001.jpg"

@LargeTest
@RunWith(AndroidJUnit4::class)
class BitmapBenchmark {

    @get:Rule
    val benchmarkRule = BenchmarkRule()

    private val context = ApplicationProvider.getApplicationContext<Context>()
    private lateinit var bitmap: Bitmap

    @Before
    fun setUp() {
        val inputStream = context.assets.open(JETPACK)
        bitmap = BitmapFactory.decodeStream(inputStream)
        inputStream.close()
    }


    @Test
    fun bitmapGetPixelBenchmark() {
        val pixels = IntArray(100) { it }
        benchmarkRule.measureRepeated {
            pixels.map { bitmap.getPixel(it, 0) }
        }
    }

   //æµ‹è¯•100åƒç´ å›¾åƒç»˜åˆ¶è€—æ—¶
    @Test
    fun bitmapGetPixelsBenchmark() {
        val pixels = IntArray(100) { it }
        benchmarkRule.measureRepeated {
            bitmap.getPixels(pixels, 0, 100, 0, 0, 100, 1)
        }
    }
}    
```

ç„¶åå³é”®`BitmapBenchmark`ç±»è¿è¡Œï¼Œæ³¨æ„éœ€è¦åœ¨çœŸæœºè¿è¡Œï¼Œæ§åˆ¶å°æ‰“å°å‡ºä¸¤ä¸ªæ–¹æ³•çš„è€—æ—¶



```kotlin
Started running tests

benchmark:         2,086 ns BitmapBenchmark.bitmapGetPixelsBenchmark
benchmark:        70,902 ns BitmapBenchmark.bitmapGetPixelBenchmark
Tests ran to completion.
```

è¿™å°±æ˜¯`Benchmark`åº“çš„ç®€å•ä½¿ç”¨ï¼Œæˆ‘ç†è§£`benchmark`è¿™ä¸ªæ¨¡å—æ˜¯åœ¨å•å…ƒæµ‹è¯•çš„åŸºç¡€ä¸Šå¯ä»¥æä¾›æ›´å¤šæ€§èƒ½æµ‹è¯•çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ‰§è¡Œæ—¶é—´ç­‰ã€‚ä½†æ˜¯å®é™…ä½¿ç”¨çš„è¯å¥½åƒå¤§å®¶éƒ½ç”¨çš„æ¯”è¾ƒå°‘ï¼Ÿä»¥åä¼šå¤šå°è¯•çœ‹çœ‹ï¼Œå¦‚æœæœ‰æ‡‚çš„è€é“ä¹Ÿå¯ä»¥è¯„è®ºåŒºç§‘æ™®ä¸‹ğŸ˜ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fstudio%2Fprofile%2Fbenchmark)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fbenchmark)

#### å¤šdexå¤„ç†

è¿™ä¸ªåº”è¯¥å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ï¼Œ`65536æ–¹æ³•`æ•°é™åˆ¶ã€‚ç”±äº 65536 ç­‰äº64 X 1024ï¼Œå› æ­¤è¿™ä¸€é™åˆ¶ç§°ä¸ºâ€œ64K å¼•ç”¨é™åˆ¶â€ã€‚æ„æ€å°±æ˜¯å•ä¸ª`DEX æ–‡ä»¶`å†…å¼•ç”¨çš„æ–¹æ³•æ€»æ•°é™åˆ¶ä¸º65536ï¼Œè¶…è¿‡è¿™ä¸ªæ–¹æ³•æ•°å°±è¦æ‰“åŒ…æˆå¤šä¸ªdexã€‚

è§£å†³åŠæ³•ï¼š

- `Android5.0`ä»¥ä¸‹ï¼Œéœ€è¦æ·»åŠ MultiDexæ”¯æŒåº“ã€‚å…·ä½“åšæ³•å°±æ˜¯å¼•å…¥åº“ï¼Œå¯ç”¨MultiDexï¼Œä¿®æ”¹Applicationã€‚
- `Android5.0`ä»¥ä¸Šï¼Œé»˜è®¤å¯åŠ¨MultiDexï¼Œä¸éœ€è¦å¯¼å…¥åº“ã€‚

é—®é¢˜æ¥äº†ï¼Ÿä¸ºä»€ä¹ˆ5.0ä»¥ä¸Šå°±é»˜è®¤æ”¯æŒè¿™ä¸ªåŠŸèƒ½äº†å‘¢ï¼Ÿ

- `Android 5.0`ä¹‹å‰çš„å¹³å°ç‰ˆæœ¬ä½¿ç”¨Dalvikè¿è¡Œæ—¶æ‰§è¡Œåº”ç”¨ä»£ç ï¼ŒDalvik å°†åº”ç”¨é™åˆ¶ä¸ºæ¯ä¸ª APK åªèƒ½ä½¿ç”¨ä¸€ä¸ª classes.dex å­—èŠ‚ç æ–‡ä»¶ï¼Œä¸ºäº†ç»•è¿‡è¿™ä¸€é™åˆ¶ï¼Œåªæœ‰æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ MultiDexæ”¯æŒåº“ã€‚
- `Android 5.0`åŠæ›´é«˜ç‰ˆæœ¬ä½¿ç”¨åä¸º ART çš„è¿è¡Œæ—¶ï¼Œå®ƒæœ¬èº«æ”¯æŒä»APK æ–‡ä»¶åŠ è½½å¤šä¸ª DEX æ–‡ä»¶ã€‚ARTåœ¨åº”ç”¨å®‰è£…æ—¶æ‰§è¡Œé¢„ç¼–è¯‘ï¼Œæ‰«æclassesN.dexæ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬ç¼–è¯‘æˆå•ä¸ª.oat æ–‡ä»¶ï¼Œä»¥ä¾›Androidè®¾å¤‡æ‰§è¡Œã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fstudio%2Fbuild%2Fmultidex)

#### å®‰å…¨

> Security åº“æä¾›äº†ä¸è¯»å–å’Œå†™å…¥é™æ€æ•°æ®ä»¥åŠå¯†é’¥åˆ›å»ºå’ŒéªŒè¯ç›¸å…³çš„å®‰å…¨æœ€ä½³åšæ³•å®ç°æ–¹æ³•ã€‚

è¿™é‡Œçš„å®‰å…¨æŒ‡çš„æ˜¯æ•°æ®å®‰å…¨ï¼Œæ¶‰åŠåˆ°çš„åº“ä¸º`Security åº“`ï¼Œå…·ä½“å°±æ˜¯å®‰å…¨è¯»å†™æ–‡ä»¶ä»¥åŠå®‰å…¨è®¾ç½®å…±äº«åå¥½SharedPreferencesã€‚
 ä¸çŸ¥é“å¤§å®¶ä»¥å‰åŠ å¯†æ–‡ä»¶éƒ½æ˜¯æ€ä¹ˆåšçš„ï¼Œæˆ‘æ˜¯æŠŠæ•°æ®åŠ å¯†åå†å†™å…¥æ–‡ä»¶çš„ï¼Œç°åœ¨ç”¨`Security`åº“å°±ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚

é¦–å…ˆä»£ç å¯¼å…¥



```java
    dependencies {
        implementation "androidx.security:security-crypto:1.0.0-alpha02"
    }
```

`Security åº“`ä¸»è¦åŒ…å«ä¸¤å¤§ç±»ï¼š
 1ï¼‰**EncryptedFile**
 è¯»å†™ä¸€ä¸ªåŠ å¯†æ–‡ä»¶ï¼Œç”Ÿæˆ`EncryptedFile`ä¹‹åï¼Œæ­£å¸¸æ‰“å¼€æ–‡ä»¶æ˜¯ä¹±ç æƒ…å†µï¼Œä¹Ÿå°±æ˜¯åŠ å¯†äº†ï¼Œéœ€è¦
 EncryptedFileç›¸å…³APIæ‰èƒ½è¯»å–ã€‚çœ‹çœ‹æ€ä¹ˆå®ç°è¯»å†™çš„å§ï¼



```kotlin
    // å†™å…¥æ•°æ®
    fun writeData(context: Context, directory: File) {
        val keyGenParameterSpec = MasterKeys.AES256_GCM_SPEC
        val masterKeyAlias = MasterKeys.getOrCreate(keyGenParameterSpec)

        val fileToRead = "my_sensitive_data.txt"
        val encryptedFile = EncryptedFile.Builder(
            File(directory, fileToRead),
            context,
            masterKeyAlias,
            EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
        ).build()

        val fileContent = "MY SUPER-SECRET INFORMATION"
            .toByteArray(StandardCharsets.UTF_8)
        encryptedFile.openFileOutput().apply {
            write(fileContent)
            flush()
            close()
        }
    }
    
    // è¯»å–æ•°æ®
    fun readData(context: Context, directory: File) {
        // recommended that you use the value specified here.
        val keyGenParameterSpec = MasterKeys.AES256_GCM_SPEC
        val masterKeyAlias = MasterKeys.getOrCreate(keyGenParameterSpec)

        val fileToRead = "my_sensitive_data.txt"
        val encryptedFile = EncryptedFile.Builder(
            File(directory, fileToRead),
            context,
            masterKeyAlias,
            EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
        ).build()

        val inputStream = encryptedFile.openFileInput()
        val byteArrayOutputStream = ByteArrayOutputStream()
        var nextByte: Int = inputStream.read()
        while (nextByte != -1) {
            byteArrayOutputStream.write(nextByte)
            nextByte = inputStream.read()
        }

        val plaintext: ByteArray = byteArrayOutputStream.toByteArray()
    }
           
```

2ï¼‰**EncryptedSharedPreferences**



```kotlin
    val sharedPreferences = EncryptedSharedPreferences
        .create(
        fileName,
        masterKeyAlias,
        context,
        EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
        EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
    )

    val sharedPrefsEditor = sharedPreferences.edit()
    
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Fsecurity%2Fdata)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fsecurity)

#### æµ‹è¯•

æµ‹è¯•åº”ç”¨åœ¨Androidé¡¹ç›®ä¸­æ˜¯å¿…ä¸å¯ç¼ºçš„æ­¥éª¤ï¼ŒåŒ…æ‹¬`åŠŸèƒ½æµ‹è¯•ï¼Œé›†æˆæµ‹è¯•ï¼Œå•å…ƒæµ‹è¯•`ã€‚è¿™é‡Œä¸»è¦è¯´çš„æ˜¯é€šè¿‡ä»£ç çš„å½¢å¼ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•åº”ç”¨çš„çš„ç¨³å®šæ€§ï¼Œå®Œæ•´æ€§ç­‰ç­‰ã€‚

å…·ä½“ä½“ç°åœ¨Android Studioä¸­æœ‰ä¸¤ä¸ªæµ‹è¯•ç›®å½•ï¼š

- `androidTestç›®å½•`åº”åŒ…å«åœ¨çœŸå®æˆ–è™šæ‹Ÿè®¾å¤‡ä¸Šè¿è¡Œçš„æµ‹è¯•ã€‚
- `test ç›®å½•`åº”åŒ…å«åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œçš„æµ‹è¯•ï¼Œå¦‚å•å…ƒæµ‹è¯•ã€‚

å…·ä½“æµ‹è¯•çš„ç¼–å†™å¯ä»¥çœ‹çœ‹è¿™ä¸ªå®˜æ–¹é¡¹ç›®å­¦ä¹ ï¼š[testing-samples](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fandroid%2Ftesting-samples)ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftraining%2Ftesting)

#### TV

`Android TV`åº”ç”¨åœ¨å›½å†…è¿˜æ˜¯åº”ç”¨æ¯”è¾ƒå¹¿æ³›çš„ï¼Œå¸‚åœºä¸Šå¤§éƒ¨åˆ†ç”µè§†éƒ½æ˜¯Androidç³»ç»Ÿï¼Œæ”¯æŒAPKå®‰è£…ï¼ŒåŒ…æ‹¬åä¸ºé¸¿è’™ç³»ç»Ÿä¹Ÿæ”¯æŒAPKå®‰è£…äº†ã€‚æ‰€ä»¥æˆ‘ä»¬æ‰‹æœºä¸Šçš„åº”ç”¨åŸºæœ¬å¯ä»¥ç›´æ¥å®‰è£…åˆ°ç”µè§†ä¸Šï¼Œåªæ˜¯UIç„¦ç‚¹ç­‰æ–¹é¢éœ€è¦æ”¹è¿›ã€‚
 ä»¥ä¸‹ä»å››ä¸ªæ–¹é¢ç®€å•è¯´ä¸‹TVåº”ç”¨çš„é…ç½®ï¼Œåˆ†åˆ«æ˜¯`é…ç½®ï¼Œç¡¬ä»¶ï¼ŒæŒ‰é”®å’Œæµ‹è¯•`ã€‚
 1ï¼‰**é…ç½®**
 é¦–å…ˆï¼Œåœ¨Androidmanifest.xmlé‡Œé¢å£°æ˜Activityçš„æ—¶å€™ï¼Œå¦‚æœä½ æƒ³å…¼å®¹TVç‰ˆå’Œæ‰‹æœºç‰ˆï¼Œå¯ä»¥è®¾ç½®ä¸åŒçš„å¯åŠ¨Activityï¼Œä¸»è¦è¡¨ç°ä¸ºè®¾ç½®`android.intent.category.LEANBACK_LAUNCHER`è¿‡æ»¤å™¨ï¼š



```java
   //æ‰‹æœºå¯åŠ¨Activity
   <activity
     android:name="com.example.android.MainActivity"
     android:label="@string/app_name" >

     <intent-filter>
        <action android:name="android.intent.action.MAIN" />
        <category android:name="android.intent.category.LAUNCHER" />
     </intent-filter>
   </activity>
   
   //TVå¯åŠ¨Activity
   <activity
     android:name="com.example.android.TvActivity"
     android:label="@string/app_name"
     android:theme="@style/Theme.Leanback">

     <intent-filter>
       <action android:name="android.intent.action.MAIN" />
       <category android:name="android.intent.category.LEANBACK_LAUNCHER" />
     </intent-filter>

   </activity>   
```

2ï¼‰**ç¡¬ä»¶**
 ç¡¬ä»¶ä¸»è¦åŒ…æ‹¬å¦‚ä½•åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒæ˜¯TVç¯å¢ƒï¼Œä»¥åŠæ£€æŸ¥TVç¡¬ä»¶çš„æŸäº›åŠŸèƒ½æ˜¯å¦å­˜åœ¨ã€‚



```kotlin
    //åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒæ˜¯TVç¯å¢ƒ
    val uiModeManager = getSystemService(UI_MODE_SERVICE) as UiModeManager
    if (uiModeManager.currentModeType == Configuration.UI_MODE_TYPE_TELEVISION) {
        Log.d(TAG, "Running on a TV Device")
    } else {
        Log.d(TAG, "Running on a non-TV Device")
    }
    
    //æ£€æŸ¥TVç¡¬ä»¶çš„æŸäº›åŠŸèƒ½æ˜¯å¦å­˜åœ¨
    // Check if android.hardware.touchscreen feature is available.
    if (packageManager.hasSystemFeature(PackageManager.FEATURE_TOUCHSCREEN)) {
        Log.d("HardwareFeatureTest", "Device has a touch screen.")
    }
```

3ï¼‰ **æŒ‰é”®**
 TVä¸­çš„ç•Œé¢äº‹ä»¶ä¸»è¦åŒ…æ‹¬ï¼š



```java
   BUTTON_Bã€BACK    è¿”å›
   BUTTON_SELECTã€BUTTON_Aã€ENTERã€DPAD_CENTERã€KEYCODE_NUMPAD_ENTER    é€‰æ‹©
   DPAD_UPã€DPAD_DOWNã€DPAD_LEFTã€DPAD_RIGHT   å¯¼èˆª
```

æŒ‰é”®é…ç½®åŒ…æ‹¬ï¼š



```java
   nextFocusDown    å®šä¹‰å½“ç”¨æˆ·å‘ä¸‹å¯¼èˆªæ—¶ä¸‹ä¸€ä¸ªè·å¾—ç„¦ç‚¹çš„è§†å›¾ã€‚
   nextFocusLeft    å®šä¹‰å½“ç”¨æˆ·å‘å·¦å¯¼èˆªæ—¶ä¸‹ä¸€ä¸ªè·å¾—ç„¦ç‚¹çš„è§†å›¾ã€‚
   nextFocusRight   å®šä¹‰å½“ç”¨æˆ·å‘å³å¯¼èˆªæ—¶ä¸‹ä¸€ä¸ªè·å¾—ç„¦ç‚¹çš„è§†å›¾ã€‚
   nextFocusUp    å®šä¹‰å½“ç”¨æˆ·å‘ä¸Šå¯¼èˆªæ—¶ä¸‹ä¸€ä¸ªè·å¾—ç„¦ç‚¹çš„è§†å›¾ã€‚
   
   <TextView android:id="@+id/Category1"
             android:nextFocusDown="@+id/Category2"\>
    
```

4ï¼‰**æµ‹è¯•**
 åŒæ ·ï¼ŒTVç«¯APPçš„æµ‹è¯•å¯ä»¥ç›´æ¥é€šè¿‡TVæ¨¡æ‹Ÿå™¨æµ‹è¯•ï¼Œåœ¨`AVD Manager`é‡Œé¢åˆ›å»ºæ–°çš„TV æ¨¡æ‹Ÿæœºå³å¯ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftv)

#### Wear OS by Google

Googleçš„æ‰‹è¡¨ç³»ç»Ÿï¼ŒåŒæ ·æ˜¯ä½¿ç”¨Androidå¼€å‘ã€‚å›½å†…å¥½åƒæ²¡æœ‰åŸºäº`Wear OS`çš„æ‰‹è¡¨ï¼Œè€Œä¸”æ®æˆ‘æ‰€çŸ¥ï¼Œå›½å¤–çš„WearOSè®¾å¤‡ä¹Ÿå¾ˆå°‘äº†ï¼Œè¢«`WatchOS`å…¨é¢æ‰“è´¥ï¼Œè¿Googleæ——ä¸‹çš„App Nestéƒ½ä¸æ”¯æŒWearOSäº†ã€‚æ‰€ä»¥è¿™éƒ¨åˆ†æˆ‘ä»¬äº†è§£ä¸‹å°±è¡Œï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹çœ‹[å®˜æ–¹Demo](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fandroid%2Fwear-os-samples%2Ftree%2Fmaster%2FAlwaysOn)

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fwear)

### Jetpack-æ¶æ„ç»„ä»¶

è¿™ä¸ªæ¨¡å—çš„ç»„ä»¶å°±æ˜¯ä¸“é—¨ä¸º`MVVM`æ¡†æ¶æœåŠ¡çš„ï¼Œä½†æ˜¯æ¯ä¸ªåº“éƒ½æ˜¯å¯ä»¥å•ç‹¬ä½¿ç”¨çš„ï¼Œä¹Ÿæ˜¯jetpackä¸­æ¯”è¾ƒé‡è¦çš„ä¸€å¤§æ¨¡å—ã€‚
 ç®€å•è¯´ä¸‹`MVVM`ï¼ŒModelâ€”Viewâ€”ViewModelã€‚

- `Modelå±‚`ä¸»è¦æŒ‡æ•°æ®ï¼Œæ¯”å¦‚æœåŠ¡å™¨æ•°æ®ï¼Œæœ¬åœ°æ•°æ®åº“æ•°æ®ï¼Œæ‰€ä»¥ç½‘ç»œæ“ä½œå’Œæ•°æ®åº“è¯»å–å°±æ˜¯è¿™ä¸€å±‚ï¼Œåªä¿å­˜æ•°æ®ã€‚
- `Viewå±‚`ä¸»è¦æŒ‡UIç›¸å…³ï¼Œæ¯”å¦‚xmlå¸ƒå±€æ–‡ä»¶ï¼ŒActivityç•Œé¢æ˜¾ç¤º
- `ViewModelå±‚`æ˜¯MVVMçš„æ ¸å¿ƒï¼Œè¿æ¥viewå’Œmodelï¼Œéœ€è¦å°†modelçš„æ•°æ®å±•ç¤ºåˆ°viewä¸Šï¼Œä»¥åŠviewä¸Šçš„æ“ä½œæ•°æ®åæ˜ è½¬åŒ–åˆ°modelå±‚ï¼Œæ‰€ä»¥å°±ç›¸å½“äºä¸€ä¸ªåŒå‘ç»‘å®šã€‚

æ‰€ä»¥å°±éœ€è¦ï¼Œ**databinding**è¿›è¡Œæ•°æ®çš„ç»‘å®šï¼Œå•å‘æˆ–è€…åŒå‘ã€‚**viewmodel**è¿›è¡Œæ•°æ®ç®¡ç†ï¼Œç»‘å®šviewå’Œæ•°æ®ã€‚**lifecycle**è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚**LiveData**è¿›è¡Œæ•°æ®çš„åŠæ—¶åé¦ˆã€‚
 è¿«ä¸åŠå¾…äº†å§ï¼Œè·Ÿéšæˆ‘ä¸€èµ·çœ‹çœ‹æ¯ä¸ªåº“çš„ç¥å¥‡ä¹‹å¤„ã€‚

#### æ•°æ®ç»‘å®š

> æ•°æ®ç»‘å®šåº“æ˜¯ä¸€ç§æ”¯æŒåº“ï¼Œå€ŸåŠ©è¯¥åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å£°æ˜æ€§æ ¼å¼ï¼ˆè€Œéç¨‹åºåŒ–åœ°ï¼‰å°†å¸ƒå±€ä¸­çš„ç•Œé¢ç»„ä»¶ç»‘å®šåˆ°åº”ç”¨ä¸­çš„æ•°æ®æºã€‚

ä¸»è¦æŒ‡çš„å°±æ˜¯æ•°æ®ç»‘å®šåº“`DataBinding`ï¼Œä¸‹é¢ä»å…­ä¸ªæ–¹é¢å…·ä½“ä»‹ç»ä¸‹

é…ç½®åº”ç”¨ä½¿ç”¨æ•°æ®ç»‘å®šï¼š

```kotlin
   android {
        ...
        dataBinding {
            enabled = true
        }
    }
    
```

1ï¼‰**å¸ƒå±€å’Œç»‘å®šè¡¨è¾¾å¼**
 é€šè¿‡æ•°æ®ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥è®©xmlå¸ƒå±€æ–‡ä»¶ä¸­çš„viewä¸æ•°æ®å¯¹è±¡è¿›è¡Œç»‘å®šå’Œèµ‹å€¼ï¼Œå¹¶ä¸”å¯ä»¥å€ŸåŠ©è¡¨è¾¾å¼è¯­è¨€ç¼–å†™è¡¨è¾¾å¼æ¥å¤„ç†è§†å›¾åˆ†æ´¾çš„äº‹ä»¶ã€‚ä¸¾ä¸ªğŸŒ°ï¼š

```kotlin
    //å¸ƒå±€ activity_main.xml
    <?xml version="1.0" encoding="utf-8"?>
    <layout xmlns:android="http://schemas.android.com/apk/res/android">
       <data>
           <variable name="user" type="com.example.User"/>
       </data>
       <TextView android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:text="@{user.name}"/>
    </layout>
    
    //å®ä½“ç±»User
    data class User(val name: String)
    
    
    //Activityèµ‹å€¼
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        val binding: ActivityMainBinding = DataBindingUtil.setContentView(
                this, R.layout.activity_main)
        binding.user = User("Bob")
    }
    
```

é€šè¿‡`@{}`ç¬¦å·ï¼Œå¯ä»¥åœ¨å¸ƒå±€ä¸­ä½¿ç”¨æ•°æ®å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡DataBindingUtilè·å–èµ‹å€¼å¯¹è±¡ã€‚å¹¶ä¸”`@{}`é‡Œé¢çš„è¡¨è¾¾å¼è¯­è¨€æ”¯æŒå¤šç§è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ç®—æœ¯è¿ç®—ç¬¦ï¼Œé€»è¾‘è¿ç®—ç¬¦ç­‰ç­‰ã€‚

2ï¼‰**å¯è§‚å¯Ÿçš„æ•°æ®å¯¹è±¡**
 å¯è§‚å¯Ÿæ€§æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡å°†å…¶æ•°æ®å˜åŒ–å‘ŠçŸ¥å…¶ä»–å¯¹è±¡çš„èƒ½åŠ›ã€‚é€šè¿‡æ•°æ®ç»‘å®šåº“ï¼Œæ‚¨å¯ä»¥è®©å¯¹è±¡ã€å­—æ®µæˆ–é›†åˆå˜ä¸ºå¯è§‚å¯Ÿã€‚

æ¯”å¦‚ä¸Šæ–‡åˆšè¯´åˆ°çš„Userç±»ï¼Œæˆ‘ä»¬å°†nameå±æ€§æ”¹æˆå¯è§‚å¯Ÿå¯¹è±¡ï¼Œ



```kotlin
   data class User(val name: ObservableField<String>)
   
   val userName = ObservableField<String>()
   userName.set("Bob")

   val binding: ActivityMainBinding = DataBindingUtil.setContentView(
                this, R.layout.activity_main)
   binding.user = User(userName)   
```

ç„¶åç»‘å®šåˆ°å¸ƒå±€ä¸­ï¼Œè¿™æ—¶å€™è¿™ä¸ªUserçš„`name`å±æ€§å°±æ˜¯è¢«è§‚å¯Ÿå¯¹è±¡äº†ï¼Œå¦‚æœ`userName`æ”¹å˜ï¼Œå¸ƒå±€é‡Œé¢çš„`TextView`æ˜¾ç¤ºæ•°æ®ä¹Ÿä¼šè·Ÿç€æ”¹å˜ï¼Œè¿™å°±æ˜¯å¯è§‚å¯Ÿæ•°æ®å¯¹è±¡ã€‚

3ï¼‰**ç”Ÿæˆçš„ç»‘å®šç±»**

åˆšæ‰æˆ‘ä»¬è·å–ç»‘å®šå¸ƒå±€æ˜¯é€šè¿‡`DataBindingUtil.setContentView`æ–¹æ³•ç”ŸæˆActivityMainBindingå¯¹è±¡å¹¶ç»‘å®šå¸ƒå±€ã€‚é‚£ä¹ˆActivityMainBindingç±»æ˜¯æ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿåªè¦ä½ çš„å¸ƒå±€ç”¨`layout`å±æ€§åŒ…å›´ï¼Œç¼–è¯‘åå°±ä¼šè‡ªåŠ¨ç”Ÿæˆç»‘å®šç±»ï¼Œç±»åç§°åŸºäºå¸ƒå±€æ–‡ä»¶çš„åç§°ï¼Œå®ƒä¼šè½¬æ¢ä¸º `Pascal` å¤§å°å†™å½¢å¼å¹¶åœ¨æœ«å°¾æ·»åŠ  Binding åç¼€ã€‚

æ­£å¸¸åˆ›å»ºç»‘å®šå¯¹è±¡æ˜¯é€šè¿‡å¦‚ä¸‹å†™æ³•ï¼š



```kotlin
    //Activity
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        val binding: MyLayoutBinding = MyLayoutBinding.inflate(layoutInflater)
        setContentView(binding.root)
    }
    
    
    //Fragment
    @Nullable
    fun onCreateView( inflater: LayoutInflater?, container: ViewGroup?, savedInstanceState: Bundle?): View? {
        mDataBinding = DataBindingUtil.inflate(inflater, R.layout.fragment_layout, container, false)
        return mDataBinding.getRoot()
    }
```

4ï¼‰**ç»‘å®šé€‚é…å™¨**

é€‚é…å™¨è¿™é‡ŒæŒ‡çš„æ˜¯å¸ƒå±€ä¸­çš„å±æ€§è®¾ç½®ï¼Œ`android:text="@{user.name}"`è¡¨è¾¾å¼ä¸ºä¾‹ï¼Œåº“ä¼šæŸ¥æ‰¾æ¥å—`user.getName()`æ‰€è¿”å›ç±»å‹çš„`setText(arg)` æ–¹æ³•ã€‚
 é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªé€‚é…å™¨äº†ï¼Œä¹Ÿå°±æ˜¯å¸ƒå±€é‡Œé¢çš„å±æ€§æˆ‘ä»¬å¯ä»¥éšä¾¿å®šä¹‰å®ƒçš„åå­—å’Œä½œç”¨ã€‚æ¥ä¸ªğŸŒ°



```kotlin
    @BindingAdapter("imageUrl")
    fun loadImage(view: ImageView, url: String) {
        Picasso.get().load(url).into(view)
    }
    
    <ImageView app:imageUrl="@{venue.imageUrl}" />
```

åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªå¤–éƒ¨å¯ä»¥è®¿é—®çš„æ–¹æ³•`loadImage`ï¼Œæ³¨é‡Š`@BindingAdapter`é‡Œé¢çš„å±æ€§ä¸ºä½ éœ€è¦å®šä¹‰çš„å±æ€§åç§°ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯imageUrlã€‚æ‰€ä»¥åœ¨å¸ƒå±€ä¸­å°±å¯ä»¥ä½¿ç”¨`app:imageUrl`ï¼Œå¹¶ä¼ å€¼ä¸ºStringç±»å‹ï¼Œç³»ç»Ÿå°±ä¼šæ‰¾åˆ°è¿™ä¸ªé€‚é…å™¨æ–¹æ³•å¹¶æ‰§è¡Œã€‚

5ï¼‰**å°†å¸ƒå±€è§†å›¾ç»‘å®šåˆ°æ¶æ„ç»„ä»¶**
 è¿™ä¸€å—å°±æ˜¯å®é™…åº”ç”¨äº†ï¼Œå’Œjetpackå…¶ä»–ç»„ä»¶ç›¸ç»“åˆä½¿ç”¨ï¼Œå½¢æˆå®Œæ•´çš„`MVVM`åˆ†å±‚æ¶æ„ã€‚



```kotlin
        // Obtain the ViewModel component.
        val userModel: UserViewModel by viewModels()

        // Inflate view and obtain an instance of the binding class.
        val binding: ActivityDatabindingMvvmBinding =
            DataBindingUtil.setContentView(this, R.layout.activity_databinding_mvvm)

        // Assign the component to a property in the binding class.
        binding.viewmodel = userModel
        
    <data>
        <variable
            name="viewmodel"
            type="com.panda.jetpackdemo.dataBinding.UserViewModel" />
    </data>
    
    class UserViewModel : ViewModel() {
    val currentName: MutableLiveData<String> by lazy {
        MutableLiveData<String>()
    }

    init {
        currentName.value="zzz"
    }
}
```

6ï¼‰**åŒå‘æ•°æ®ç»‘å®š**

åˆšæ‰æˆ‘ä»¬ä»‹ç»çš„éƒ½æ˜¯å•å‘ç»‘å®šï¼Œä¹Ÿå°±æ˜¯å¸ƒå±€ä¸­viewç»‘å®šäº†æ•°æ®å¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚ä½•è®©æ•°æ®å¯¹è±¡ä¹Ÿå¯¹viewäº§ç”Ÿç»‘å®šå‘¢ï¼Ÿä¹Ÿå°±æ˜¯`viewæ”¹å˜`çš„æ—¶å€™æ•°æ®å¯¹è±¡ä¹Ÿèƒ½æ¥æ”¶åˆ°è®¯æ¯ï¼Œå½¢æˆ`åŒå‘ç»‘å®š`ã€‚

å¾ˆç®€å•ï¼Œæ¯”å¦‚ä¸€ä¸ªEditTextï¼Œéœ€æ±‚æ˜¯EditTextæ”¹å˜çš„æ—¶å€™ï¼Œuserå¯¹è±¡nameæ•°æ®ä¹Ÿä¼šè·Ÿç€æ”¹å˜ï¼Œåªéœ€è¦æŠŠä¹‹å‰çš„"@{}"æ”¹æˆ"@={}"



```kotlin
    //å¸ƒå±€ activity_main.xml
    <?xml version="1.0" encoding="utf-8"?>
    <layout xmlns:android="http://schemas.android.com/apk/res/android">
       <data>
           <variable name="user" type="com.example.User"/>
       </data>
       <EditText android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:text="@={user.name}"/>
    </layout>
```

å¾ˆç®€å•å§ï¼ŒåŒæ ·ï¼Œè¿™ä¸ªåŒå‘ç»‘å®šåŠŸèƒ½ä¹Ÿæ˜¯æ”¯æŒè‡ªå®šä¹‰çš„ã€‚æ¥ä¸ªğŸŒ°



```kotlin
object SwipeRefreshLayoutBinding {

    //æ–¹æ³•1ï¼Œæ•°æ®ç»‘å®šåˆ°view
    @JvmStatic
    @BindingAdapter("app:bind_refreshing")
    fun setSwipeRefreshLayoutRefreshing(swipeRefreshLayout: SwipeRefreshLayout,newValue: Boolean) {
        if (swipeRefreshLayout.isRefreshing != newValue)
            swipeRefreshLayout.isRefreshing = newValue
    }

    //æ–¹æ³•1ï¼Œviewæ”¹å˜ä¼šé€šçŸ¥bind_refreshingChangedï¼Œå¹¶ä¸”ä»è¯¥æ–¹æ³•è·å–viewçš„æ•°æ®
    @JvmStatic
    @InverseBindingAdapter(attribute = "app:bind_refreshing",event = "app:bind_refreshingChanged")
    fun isSwipeRefreshLayoutRefreshing(swipeRefreshLayout: SwipeRefreshLayout): Boolean =swipeRefreshLayout.isRefreshing
            
    //æ–¹æ³•3ï¼Œviewå¦‚ä½•æ”¹å˜æ¥å½±å“æ•°æ®å†…å®¹  
    @JvmStatic
    @BindingAdapter("app:bind_refreshingChanged",requireAll = false)
    fun setOnRefreshListener(swipeRefreshLayout: SwipeRefreshLayout,bindingListener: InverseBindingListener?) {
        if (bindingListener != null)
            swipeRefreshLayout.setOnRefreshListener {
                bindingListener.onChange()
            }
    }
}


<androidx.swiperefreshlayout.widget.SwipeRefreshLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        app:bind_refreshing="@={viewModel.refreshing }">
</androidx.swiperefreshlayout.widget.SwipeRefreshLayout>
```

ç®€å•è¯´æ˜ä¸‹ï¼Œé¦–å…ˆé€šè¿‡`bind_refreshing`å±æ€§ï¼Œå°†æ•°æ®`viewModel.refreshing`ç»‘å®šåˆ°viewä¸Šï¼Œè¿™æ ·æ•°æ®å˜åŒ–ï¼Œviewä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚ç„¶åviewå˜åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡`InverseBindingAdapter`æ³¨é‡Šï¼Œä¼šè°ƒç”¨`bind_refreshingChanged`äº‹ä»¶ï¼Œè€Œbind_refreshingChangedäº‹ä»¶å‘Šè¯‰äº†æˆ‘ä»¬viewä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ä¹Ÿå°±æ˜¯swipeRefreshLayoutä¸‹æ»‘çš„æ—¶å€™ä¼šå¯¼è‡´æ•°æ®è¿›è¡Œæ”¹å˜ï¼Œäºæ˜¯æ•°æ®å¯¹è±¡ä¼šä»`isSwipeRefreshLayoutRefreshing`æ–¹æ³•è·å–åˆ°æœ€æ–°çš„æ•°å€¼ï¼Œä¹Ÿå°±æ˜¯ä»viewæ›´æ–°è¿‡æ¥çš„æ•°æ®ã€‚

è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯ï¼ŒåŒå‘ç»‘å®šè¦è€ƒè™‘åˆ°æ­»å¾ªç¯é—®é¢˜ï¼Œå½“Viewè¢«æ”¹å˜ï¼Œæ•°æ®å¯¹è±¡å¯¹åº”å‘ç”Ÿæ›´æ–°ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªæ›´æ–°åˆå›é€šçŸ¥Viewå±‚å»åˆ·æ–°UIï¼Œç„¶åviewè¢«æ”¹å˜åˆä¼šå¯¼è‡´æ•°æ®å¯¹è±¡æ›´æ–°ï¼Œæ— é™å¾ªç¯ä¸‹å»äº†ã€‚æ‰€ä»¥é˜²æ­¢æ­»å¾ªç¯çš„åšæ³•å°±æ˜¯åˆ¤æ–­viewçš„æ•°æ®çŠ¶æ€ï¼Œå½“å‘ç”Ÿæ”¹å˜çš„æ—¶å€™æ‰å»æ›´æ–°viewã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Fdata-binding)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2FdataBinding)

#### Lifecycles

> ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶å¯æ‰§è¡Œæ“ä½œæ¥å“åº”å¦ä¸€ä¸ªç»„ä»¶ï¼ˆå¦‚ Activity å’Œ Fragmentï¼‰çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„å˜åŒ–ã€‚è¿™äº›ç»„ä»¶æœ‰åŠ©äºæ‚¨å†™å‡ºæ›´æœ‰æ¡ç†ä¸”å¾€å¾€æ›´ç²¾ç®€çš„ä»£ç ï¼Œè¿™æ ·çš„ä»£ç æ›´æ˜“äºç»´æŠ¤ã€‚

`Lifecycles`ï¼Œç§°ä¸ºç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶ï¼Œå¯ä»¥æ„ŸçŸ¥å’Œå“åº”å¦ä¸€ä¸ªç»„ä»¶ï¼ˆå¦‚ Activity å’Œ Fragmentï¼‰çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„å˜åŒ–ã€‚

å¯èƒ½æœ‰äººä¼šç–‘æƒ‘äº†ï¼Œç”Ÿå‘½å‘¨æœŸå°±é‚£å‡ ä¸ªï¼Œæˆ‘ä¸ºå•¥è¿˜è¦å¯¼å…¥ä¸€ä¸ªåº“å‘¢ï¼Ÿæœ‰äº†åº“éš¾é“å°±ä¸ç”¨å†™ç”Ÿå‘½å‘¨æœŸäº†å—ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ
 ä¸¾ä¸ªğŸŒ°ï¼Œè®©ä½ æ„Ÿå—ä¸‹ã€‚

é¦–å…ˆå¯¼å…¥åº“ï¼Œå¯ä»¥æ ¹æ®å®é™…é¡¹ç›®æƒ…å†µå¯¼å…¥



```kotlin
        // ViewModel
        implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycle_version"
        // LiveData
        implementation "androidx.lifecycle:lifecycle-livedata-ktx:$lifecycle_version"
        // Lifecycles only (without ViewModel or LiveData)
        implementation "androidx.lifecycle:lifecycle-runtime-ktx:$lifecycle_version"
        //.......
```

ç°åœ¨æœ‰ä¸€ä¸ªå®šä½ç›‘å¬å™¨ï¼Œéœ€è¦åœ¨`Activity`å¯åŠ¨çš„æ—¶å€™å¼€å¯ï¼Œé”€æ¯çš„æ—¶å€™å…³é—­ã€‚æ­£å¸¸ä»£ç å¦‚ä¸‹ï¼š



```kotlin
class BindingActivity : AppCompatActivity() {

    private lateinit var myLocationListener: MyLocationListener

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        myLocationListener = MyLocationListener(this) { location ->
            // update UI
        }
    }
    public override fun onStart() {
        super.onStart()
        myLocationListener.start()       
    }
    public override fun onStop() {
        super.onStop()
        myLocationListener.stop()
    }

    internal class MyLocationListener(
            private val context: Context,
            private val callback: (Location) -> Unit
    ) {
        fun start() {
            // connect to system location service
        }
        fun stop() {
            // disconnect from system location service
        }
    }
    
}
```

ä¹ä¸€çœ‹ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜æ˜¯å§ï¼Œä½†æ˜¯å¦‚æœéœ€è¦ç®¡ç†ç”Ÿå‘½å‘¨æœŸçš„ç±»ä¸€å¤šï¼Œæ˜¯ä¸æ˜¯å°±ä¸å¥½ç®¡ç†äº†ã€‚æ‰€æœ‰çš„ç±»éƒ½è¦åœ¨Activityé‡Œé¢ç®¡ç†ï¼Œè¿˜å®¹æ˜“æ¼æ‰ã€‚
 æ‰€ä»¥è§£å†³åŠæ³•å°±æ˜¯å®ç°`è§£è€¦`ï¼Œè®©éœ€è¦ç®¡ç†ç”Ÿå‘½å‘¨æœŸçš„ç±»`è‡ªå·±ç®¡ç†`ï¼Œè¿™æ ·Activityä¹Ÿä¸ä¼šé—æ¼å’Œè‡ƒè‚¿äº†ã€‚ä¸Šä»£ç ï¼š



```kotlin
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        myLocationListener = MyLocationListener(this) { location ->
            // update UI
        }
       lifecycle.addObserver(myLocationListener)
    }



    internal class MyLocationListener (
            private val context: Context,
            private val callback: (Location) -> Unit
    ): LifecycleObserver {

        @OnLifecycleEvent(Lifecycle.Event.ON_START)
        fun start() {

        }

        @OnLifecycleEvent(Lifecycle.Event.ON_STOP)
        fun stop() {
            // disconnect if connected
        }
    }
```

å¾ˆç®€å•å§ï¼Œåªè¦å®ç°`LifecycleObserver`æ¥å£ï¼Œå°±å¯ä»¥ç”¨æ³¨é‡Šçš„æ–¹å¼æ‰§è¡Œæ¯ä¸ªç”Ÿå‘½å‘¨æœŸè¦æ‰§è¡Œçš„æ–¹æ³•ã€‚ç„¶ååœ¨Activityé‡Œé¢`addObserver`ç»‘å®šå³å¯ã€‚

åŒæ ·çš„ï¼Œ`Lifecycle`ä¹Ÿæ”¯æŒè‡ªå®šä¹‰ç”Ÿå‘½å‘¨æœŸï¼Œåªè¦ç»§æ‰¿LifecycleOwnerå³å¯ï¼Œç„¶åé€šè¿‡`markState`æ–¹æ³•è®¾å®šè‡ªå·±ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸¾ä¸ªğŸŒ°

```kotlin
class BindingActivity : AppCompatActivity(), LifecycleOwner {

    private lateinit var lifecycleRegistry: LifecycleRegistry

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        lifecycleRegistry = LifecycleRegistry(this)
        lifecycleRegistry.markState(Lifecycle.State.CREATED)
    }

    public override fun onStart() {
        super.onStart()
        lifecycleRegistry.markState(Lifecycle.State.STARTED)
    }
}    
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Flifecycle)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Flifecycle)

#### LiveData

> LiveData æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ã€‚ä¸å¸¸è§„çš„å¯è§‚å¯Ÿç±»ä¸åŒï¼ŒLiveData å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ï¼Œæ„æŒ‡å®ƒéµå¾ªå…¶ä»–åº”ç”¨ç»„ä»¶ï¼ˆå¦‚ Activityã€Fragment æˆ– Serviceï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§æ„ŸçŸ¥èƒ½åŠ›å¯ç¡®ä¿ LiveData ä»…æ›´æ–°å¤„äºæ´»è·ƒç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„åº”ç”¨ç»„ä»¶è§‚å¯Ÿè€…ã€‚

`LiveData` æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ã€‚
 ç­‰ç­‰ï¼Œè¿™ä¸ªä»‹ç»å¥½åƒä¼¼æ›¾ç›¸è¯†ï¼Ÿå¯¹ï¼Œå‰é¢è¯´æ•°æ®ç»‘å®šçš„æ—¶å€™å°±æœ‰ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ•°æ®å¯¹è±¡`ObservableField`ã€‚é‚£ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

1ï¼‰`LiveData` å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ï¼Œå¯ä»¥æ„ŸçŸ¥åˆ°Activityç­‰çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™æ ·æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå¾ˆå¸¸è§çš„ä¸€ç‚¹å°±æ˜¯å¯ä»¥å‡å°‘å†…å­˜æ³„æ¼å’Œå´©æºƒæƒ…å†µäº†å‘€ï¼Œæƒ³æƒ³ä»¥å‰ä½ çš„é¡¹ç›®ä¸­é’ˆå¯¹ç½‘ç»œæ¥å£è¿”å›æ•°æ®çš„æ—¶å€™éƒ½è¦åˆ¤æ–­å½“å‰ç•Œé¢æ˜¯å¦é”€æ¯ï¼Œç°åœ¨LiveDataå°±å¸®ä½ è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

å…·ä½“ä¸ºä»€ä¹ˆèƒ½è§£å†³å´©æºƒå’Œæ³„æ¼é—®é¢˜å‘¢ï¼Ÿ

- `ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼`
   è§‚å¯Ÿè€…ä¼šç»‘å®šåˆ° Lifecycle å¯¹è±¡ï¼Œå¹¶åœ¨å…¶å…³è”çš„ç”Ÿå‘½å‘¨æœŸé­åˆ°é”€æ¯åè¿›è¡Œè‡ªæˆ‘æ¸…ç†ã€‚
- `ä¸ä¼šå›  Activity åœæ­¢è€Œå¯¼è‡´å´©æºƒ`
   å¦‚æœè§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸå¤„äºéæ´»è·ƒçŠ¶æ€ï¼ˆå¦‚è¿”å›æ ˆä¸­çš„ Activityï¼‰ï¼Œåˆ™å®ƒä¸ä¼šæ¥æ”¶ä»»ä½• LiveData äº‹ä»¶ã€‚
- `è‡ªåŠ¨åˆ¤æ–­ç”Ÿå‘½å‘¨æœŸå¹¶å›è°ƒæ–¹æ³•`
   å¦‚æœè§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸå¤„äº STARTED æˆ– RESUMEDçŠ¶æ€ï¼Œåˆ™ LiveData ä¼šè®¤ä¸ºè¯¥è§‚å¯Ÿè€…å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå°±ä¼šè°ƒç”¨onActiveæ–¹æ³•ï¼Œå¦åˆ™ï¼Œå¦‚æœ LiveData å¯¹è±¡æ²¡æœ‰ä»»ä½•æ´»è·ƒè§‚å¯Ÿè€…æ—¶ï¼Œä¼šè°ƒç”¨ onInactive()æ–¹æ³•ã€‚

2ï¼‰ LiveDataæ›´æ–°æ•°æ®æ›´çµæ´»ï¼Œä¸ä¸€å®šæ˜¯æ”¹å˜æ•°æ®ï¼Œè€Œæ˜¯è°ƒç”¨æ–¹æ³•`ï¼ˆpostValueæˆ–è€…setValueï¼‰`çš„æ–¹å¼è¿›è¡ŒUIæ›´æ–°æˆ–è€…å…¶ä»–æ“ä½œã€‚

å¥½äº†ã€‚è¿˜æ˜¯ä¸¾ä¸ªğŸŒ°æ›´ç›´è§‚çš„çœ‹çœ‹å§ï¼š



```kotlin
    //å¯¼å…¥åº“ï¼š
    implementation "androidx.lifecycle:lifecycle-livedata-ktx:2.2.0"

    class StockLiveData(symbol: String) : LiveData<BigDecimal>() {
        private val stockManager = StockManager(symbol)

        private val listener = { price: BigDecimal ->
            value = price
        }

        override fun onActive() {
            stockManager.requestPriceUpdates(listener)
        }

        override fun onInactive() {
            stockManager.removeUpdates(listener)
        }
    }
    
    public class MyFragment : Fragment() {
        override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
            super.onViewCreated(view, savedInstanceState)
            val myPriceListener: LiveData<BigDecimal> = StockLiveData("")
            myPriceListener.observe(this, Observer<BigDecimal> { price: BigDecimal? ->
                // ç›‘å¬livedataçš„æ•°æ®å˜åŒ–ï¼Œå¦‚æœè°ƒç”¨äº†setValueæˆ–è€…postValueä¼šè°ƒç”¨è¯¥onChangedæ–¹æ³•
                //æ›´æ–°UIæ•°æ®æˆ–è€…å…¶ä»–å¤„ç†
            })
        }
    }
        
```

è¿™æ˜¯ä¸€ä¸ªè‚¡ç¥¨æ•°æ®å¯¹è±¡ï¼Œ`StockManager`ä¸ºè‚¡ç¥¨ç®¡ç†å™¨ï¼Œå¦‚æœè¯¥å¯¹è±¡æœ‰æ´»è·ƒè§‚å¯Ÿè€…æ—¶ï¼Œå°±å»ç›‘å¬è‚¡ç¥¨å¸‚åœºçš„æƒ…å†µï¼Œå¦‚æœæ²¡æœ‰æ´»è·ƒè§‚å¯Ÿè€…æ—¶ï¼Œå°±å¯ä»¥æ–­å¼€ç›‘å¬ã€‚
 å½“ç›‘å¬åˆ°è‚¡ç¥¨ä¿¡æ¯å˜åŒ–ï¼Œè¯¥è‚¡ç¥¨æ•°æ®å¯¹è±¡å°±ä¼šé€šè¿‡`setValue`æ–¹æ³•è¿›è¡Œæ•°æ®æ›´æ–°ï¼Œååº”åˆ°è§‚å¯Ÿè€…çš„onChangedæ–¹æ³•ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯`setValue`æ–¹æ³•åªèƒ½åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œè€Œ`postValue`åˆ™æ˜¯åœ¨å…¶ä»–çº¿ç¨‹è°ƒç”¨ã€‚
 å½“`Fragment`è¿™ä¸ªè§‚å¯Ÿè€…ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿå˜åŒ–æ—¶ï¼Œ`LiveData`å°±ä¼šç§»é™¤è¿™ä¸ªè§‚å¯Ÿè€…ï¼Œä¸å†å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¹Ÿå°±é¿å…å´©æºƒé—®é¢˜ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Flivedata)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Flivedata)

#### Navigation

> å¯¼èˆª
>  Navigation ç»„ä»¶æ—¨åœ¨ç”¨äºå…·æœ‰ä¸€ä¸ªä¸» Activity å’Œå¤šä¸ª Fragment ç›®çš„åœ°çš„åº”ç”¨ã€‚ä¸» Activity ä¸å¯¼èˆªå›¾ç›¸å…³è”ï¼Œä¸”åŒ…å«ä¸€ä¸ªè´Ÿè´£æ ¹æ®éœ€è¦äº¤æ¢ç›®çš„åœ°çš„ NavHostFragmentã€‚åœ¨å…·æœ‰å¤šä¸ª Activity ç›®çš„åœ°çš„åº”ç”¨ä¸­ï¼Œæ¯ä¸ª Activity å‡æ‹¥æœ‰å…¶è‡ªå·±çš„å¯¼èˆªå›¾ã€‚

æ‰€ä»¥è¯´ç™½äº†ï¼Œ`Navigation`å°±æ˜¯ä¸€ä¸ª`Fragment`çš„ç®¡ç†æ¡†æ¶ã€‚
 æ€ä¹ˆå®ç°ï¼Ÿåˆ›å»ºActivityï¼ŒFragmentï¼Œè¿›è¡Œè¿æ¥ã€‚

1ï¼‰**å¯¼å…¥åº“**



```kotlin
  def nav_version = "2.3.0"
  implementation "androidx.navigation:navigation-fragment-ktx:$nav_version"
  implementation "androidx.navigation:navigation-ui-ktx:$nav_version"
```

2ï¼‰**åˆ›å»º3ä¸ªFragmentå’Œä¸€ä¸ªActivity**

3ï¼‰**åˆ›å»ºres/navigation/my_nav.xml æ–‡ä»¶**



```kotlin
<?xml version="1.0" encoding="utf-8"?>
<navigation xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    xmlns:android="http://schemas.android.com/apk/res/android"
    app:startDestination="@id/myFragment1"
    tools:ignore="UnusedNavigation">

    <fragment
        android:id="@+id/myFragment1"
        android:name="com.example.studynote.blog.jetpack.navigation.MyFragment1"
        android:label="fragment_blank"
        tools:layout="@layout/fragmetn_my_1" >
        <action
            android:id="@+id/action_blankFragment_to_blankFragment2"
            app:destination="@id/myFragment2" />
    </fragment>

    <fragment
        android:id="@+id/myFragment2"
        android:name="com.example.studynote.blog.jetpack.navigation.MyFragment1"
        android:label="fragment_blank"
        tools:layout="@layout/fragmetn_my_1" >
        <action
            android:id="@+id/action_blankFragment_to_blankFragment2"
            app:destination="@id/myFragment3" />
    </fragment>

    <fragment
        android:id="@+id/myFragment3"
        android:name="com.example.studynote.blog.jetpack.navigation.MyFragment1"
        android:label="fragment_blank"
        tools:layout="@layout/fragmetn_my_1" >
    </fragment>
</navigation>
```

åœ¨resæ–‡ä»¶å¤¹ä¸‹æ–°å»º`navigation`ç›®å½•ï¼Œå¹¶æ–°å»º`my_nav.xml` æ–‡ä»¶ã€‚é…ç½®å¥½æ¯ä¸ªFragmentï¼Œå…¶ä¸­ï¼š

- `app:startDestination` å±æ€§ä»£è¡¨ä¸€å¼€å§‹æ˜¾ç¤ºçš„fragment
- `android:name` å±æ€§ä»£è¡¨å¯¹åº”çš„Fragmentè·¯å¾„
- `action` ä»£è¡¨è¯¥Fragmentå­˜åœ¨çš„è·³è½¬äº‹ä»¶ï¼Œæ¯”å¦‚myFragment1å¯ä»¥è·³è½¬myFragment2ã€‚

1. **ä¿®æ”¹Activityçš„å¸ƒå±€æ–‡ä»¶ï¼š**



```kotlin
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
xmlns:android="http://schemas.android.com/apk/res/android"
xmlns:app="http://schemas.android.com/apk/res-auto"
android:id="@+id/container"
android:layout_width="match_parent"
android:layout_height="match_parent">

<fragment
    android:id="@+id/nav_host_fragment"
    android:name="androidx.navigation.fragment.NavHostFragment"
    android:layout_width="0dp"
    android:layout_height="0dp"
    app:layout_constraintBottom_toBottomOf="parent"
    app:layout_constraintLeft_toLeftOf="parent"
    app:layout_constraintRight_toRightOf="parent"
    app:layout_constraintTop_toTopOf="parent"
    app:defaultNavHost="true"
    app:navGraph="@navigation/my_nav" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

å¯ä»¥çœ‹åˆ°ï¼ŒActivityçš„å¸ƒå±€æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªfragmentæ§ä»¶ï¼Œnameä¸ºNavHostFragmentï¼Œ`navGraph`ä¸ºåˆšæ‰æ–°å»ºçš„mynavigationæ–‡ä»¶ã€‚

5ï¼‰**é…ç½®å®Œäº†ä¹‹åï¼Œå°±å¯ä»¥è®¾ç½®å…·ä½“çš„è·³è½¬é€»è¾‘äº†ã€‚**



```kotlin
    override fun onClick(v: View) {
    //ä¸å¸¦å‚æ•°
 v.findNavController().navigate(R.id.action_blankFragment_to_blankFragment2)
   //å¸¦å‚æ•°
    var bundle = bundleOf("amount" to amount)
    v.findNavController().navigate(R.id.confirmationAction, bundle)
 
    }
    
    //æ¥æ”¶æ•°æ®
    tv.text = arguments?.getString("amount")
    
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè·³è½¬è¿™å—å®˜æ–¹å»ºè®®ç”¨`Safe Args` çš„Gradle æ’ä»¶ï¼Œè¯¥æ’ä»¶å¯ä»¥ç”Ÿæˆç®€å•çš„ `object å’Œ builder`ç±»ï¼Œä»¥ä¾¿ä»¥ç±»å‹å®‰å…¨çš„æ–¹å¼æµè§ˆå’Œè®¿é—®ä»»ä½•å…³è”çš„å‚æ•°ã€‚è¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»[å®˜ç½‘çœ‹çœ‹](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Fnavigation%2Fnavigation-getting-started%23ensure_type-safety_by_using_safe_args)

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Fnavigation%2F)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fnavigation)

#### Room

> Room æŒä¹…æ€§åº“åœ¨ SQLite çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåœ¨å……åˆ†åˆ©ç”¨ SQLite çš„å¼ºå¤§åŠŸèƒ½çš„åŒæ—¶ï¼Œè·äº«æ›´å¼ºå¥çš„æ•°æ®åº“è®¿é—®æœºåˆ¶ã€‚

æ‰€ä»¥`Room`å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“æ¡†æ¶ã€‚é—®é¢˜æ¥äº†ï¼Œå¸‚é¢ä¸Šé‚£ä¹ˆå¤šæ•°æ®åº“ç»„ä»¶ï¼Œæ¯”å¦‚`ormLiteï¼Œgreendao`ç­‰ç­‰ï¼Œä¸ºä»€ä¹ˆgoogleè¿˜è¦å‡ºä¸€ä¸ªroomï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ

- **æ€§èƒ½ä¼˜åŠ¿**ï¼Œä¸€æ¬¡æ•°æ®åº“æ“ä½œä¸»è¦åŒ…æ‹¬ï¼šæ„é€ sqlè¯­å¥â€”ç¼–è¯‘è¯­å¥â€”ä¼ å…¥å‚æ•°â€”æ‰§è¡Œæ“ä½œã€‚`ORMLite`ä¸»è¦åœ¨è·å–å‚æ•°å±æ€§å€¼çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡åå°„è·å–çš„ï¼Œæ‰€ä»¥é€Ÿåº¦è¾ƒæ…¢ã€‚`GreenDao`åœ¨æ„é€ sqlè¯­å¥çš„æ—¶å€™æ˜¯é€šè¿‡ä»£ç æ‹¼æ¥ï¼Œæ‰€ä»¥è¾ƒæ…¢ã€‚`Room`æ˜¯é€šè¿‡æ¥å£æ–¹æ³•çš„æ³¨è§£ç”Ÿæˆsqlè¯­å¥ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘æˆå­—èŠ‚ç çš„æ—¶å€™å°±ç”Ÿæˆäº†sqlè¯­å¥ï¼Œæ‰€ä»¥è¿è¡Œèµ·æ¥è¾ƒå¿«ã€‚
- **æ”¯æŒjetpackå…¶ä»–ç»„ä»¶ï¼ˆæ¯”å¦‚LiveDataï¼ŒPagingï¼‰ä»¥åŠRxJava**ï¼Œè¿™å°±å¥½æ¯”å€ŸåŠ©äº†å½“å‰æ‰€åœ¨çš„ä¼˜åŠ¿ç¯å¢ƒï¼Œå°±èƒ½ç»™ä½ å¸¦æ¥ä¸€äº›å¾—å¤©ç‹¬åšçš„ä¼˜åŠ¿ã€‚å½“ç„¶å®é™…ä½¿ç”¨èµ·æ¥ä¹Ÿç¡®å®è¦æ–¹ä¾¿å¾ˆå¤šï¼Œæ¯”å¦‚`liveData`ç»“åˆï¼Œå°±èƒ½åœ¨æ•°æ®æŸ¥è¯¢åè¿›è¡Œè‡ªåŠ¨UIæ›´æ–°ã€‚

æ—¢ç„¶Roomè¿™ä¹ˆä¼˜ç§€ï¼Œé‚£å°±ç”¨èµ·æ¥å§ã€‚
 Roomçš„æ¥å…¥ä¸»è¦æœ‰ä¸‰å¤§ç‚¹ï¼š`DataBaseã€Entityã€Dao`ã€‚åˆ†åˆ«å¯¹åº”æ•°æ®åº“ï¼Œè¡¨å’Œæ•°æ®è®¿é—®ã€‚

1ï¼‰**é¦–å…ˆå¯¼å…¥åº“ï¼š**



```kotlin
    apply plugin: 'kotlin-kapt'

    dependencies {
      def room_version = "2.2.5"

      implementation "androidx.room:room-runtime:$room_version"
      kapt "androidx.room:room-compiler:$room_version" // For Kotlin use kapt instead of annotationProcessor

      // optional - Kotlin Extensions and Coroutines support for Room
      implementation "androidx.room:room-ktx:$room_version"

      // optional - RxJava support for Room
      implementation "androidx.room:room-rxjava2:$room_version"
    }
    
```

2ï¼‰**å»ºç«‹æ•°æ®åº“ç±»ï¼Œå£°æ˜æ•°æ®åº“è¡¨æˆå‘˜ï¼Œæ•°æ®åº“åç§°ï¼Œæ•°æ®åº“ç‰ˆæœ¬ï¼Œå•ä¾‹ç­‰ç­‰**



```kotlin
@Database(entities = arrayOf(User::class), version = 1)
abstract class UserDb : RoomDatabase() {

    abstract fun userDao(): UserDao

    companion object {
        private var instance: UserDb? = null

        @Synchronized
        fun get(context: Context): UserDb {
            if (instance == null) {
                instance = Room.databaseBuilder(context.applicationContext,
                    UserDb::class.java, "StudentDatabase").build()
            }
            return instance!!
        }
    }
}
```

3ï¼‰**å»ºè¡¨ï¼Œå¯ä»¥è®¾ç½®ä¸»é”®ï¼Œå¤–é”®ï¼Œç´¢å¼•ï¼Œè‡ªå¢ç­‰ç­‰**



```kotlin
@Entity
data class User(@PrimaryKey(autoGenerate = true) val id: Int,
                val name: String)
```

4ï¼‰**Daoï¼Œæ•°æ®æ“ä½œ**



```kotlin
@Dao
interface UserDao {

    @Query("SELECT * FROM User")
    fun getAllUser(): DataSource.Factory<Int, User>

    @Query("SELECT * FROM User")
    fun getAllUser2(): LiveData<List<User>>

    @Query("SELECT * from user")
    fun getAllUser3(): Flowable<List<User>>

    @Insert
    fun insert(users: List<User>)
}
```

ç„¶åå°±å¯ä»¥è¿›è¡Œæ•°æ®åº“æ“ä½œäº†ï¼Œå¾ˆç®€å•å§ã€‚
 [å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Froom)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fpaging_room)

#### Paging

> åˆ†é¡µåº“å¯å¸®åŠ©æ‚¨ä¸€æ¬¡åŠ è½½å’Œæ˜¾ç¤ºä¸€å°å—æ•°æ®ã€‚æŒ‰éœ€è½½å…¥éƒ¨åˆ†æ•°æ®ä¼šå‡å°‘ç½‘ç»œå¸¦å®½å’Œç³»ç»Ÿèµ„æºçš„ä½¿ç”¨é‡ã€‚

æ‰€ä»¥`Paging`å°±æ˜¯ä¸€ä¸ªåˆ†é¡µåº“ï¼Œä¸»è¦ç”¨äºRecycleviewåˆ—è¡¨å±•ç¤ºã€‚ä¸‹é¢æˆ‘å°±ç»“åˆRoomè¯´è¯´Pagingçš„ç”¨æ³•ã€‚
 ä½¿ç”¨Pagingä¸»è¦æ³¨æ„ä¸¤ä¸ªç±»ï¼š`PagedListå’ŒPagedListAdapter`ã€‚
 1ï¼‰**PagedList**
 ç”¨äºåŠ è½½åº”ç”¨æ•°æ®å—ï¼Œç»‘å®šæ•°æ®åˆ—è¡¨ï¼Œè®¾ç½®æ•°æ®é¡µç­‰ã€‚ç»“åˆä¸Šè¿°`Room`çš„Demoæˆ‘ç»§ç»­å†™äº†ä¸€ä¸ª`UserModel`è¿›è¡Œæ•°æ®ç®¡ç†ï¼š



```kotlin
class UserModel(app: Application) : AndroidViewModel(app) {
    val dao = UserDb.get(app).userDao()
    var idNum = 1

    companion object {
        private const val PAGE_SIZE = 10
    }

    //åˆå§‹åŒ–PagedList
    val users = LivePagedListBuilder(
        dao.getAllUser(), PagedList.Config.Builder()
            .setPageSize(PAGE_SIZE)
            .setEnablePlaceholders(true)
            .build()
    ).build()

    //æ’å…¥ç”¨æˆ·
    fun insert() = ioThread {
        dao.insert(newTenUser())
    }

    //è·å–æ–°çš„10ä¸ªç”¨æˆ·
    fun newTenUser(): ArrayList<User> {
        var newUsers = ArrayList<User>()
        for (index in 1..10) {
            newUsers.add(User(0, "bob${++idNum}"))
        }
        return newUsers
    }

}
```

2ï¼‰**PagedListAdapter**
 ä½¿ç”¨Recycleviewå¿…è¦è¦ç”¨åˆ°adatperï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç»‘å®šä¸€ä¸ªç»§æ‰¿è‡ª`PagedListAdapter`çš„adapterï¼š



```kotlin
class UserAdapter : PagedListAdapter<User, UserAdapter.UserViewHolder>(diffCallback) {
    override fun onBindViewHolder(holder: UserViewHolder, position: Int) {
        holder.bindTo(getItem(position))
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): UserViewHolder =
        UserViewHolder(parent)

    companion object {

        private val diffCallback = object : DiffUtil.ItemCallback<User>() {
            override fun areItemsTheSame(oldItem: User, newItem: User): Boolean =
                oldItem.id == newItem.id

            override fun areContentsTheSame(oldItem: User, newItem: User): Boolean =
                oldItem == newItem
        }
    }

    class UserViewHolder(parent: ViewGroup) : RecyclerView.ViewHolder(
        LayoutInflater.from(parent.context).inflate(R.layout.list_item, parent, false)) {

        private val tv1 = itemView.findViewById<TextView>(R.id.name)
        var user: User? = null

        fun bindTo(user: User?) {
            this.user = user
            tv1.text = user?.name
        }
    }
}
```

è¿™é‡Œè¿˜ç”¨åˆ°äº†`DiffUtil.ItemCallback` ç±»ï¼Œç”¨äºæ¯”è¾ƒæ•°æ®ï¼Œè¿›è¡Œæ•°æ®æ›´æ–°ç”¨ã€‚

okï¼Œæ•°æ®æºï¼Œadapteréƒ½è®¾ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç›‘å¬æ•°æ®ï¼Œåˆ·æ–°æ•°æ®å°±å¯ä»¥äº†



```kotlin
        // ç›‘å¬usersæ•°æ®ï¼Œæ•°æ®æ”¹å˜è°ƒç”¨submitListæ–¹æ³•
        viewModel.users.observe(this, Observer(adapter::submitList))
```

å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆä¸€å¥ï¼Œç›‘å¬`PagedList`ï¼Œå¹¶ä¸”åœ¨å®ƒæ”¹å˜çš„æ—¶å€™è°ƒç”¨PagedListAdapterçš„`submitList`æ–¹æ³•ã€‚
 è¿™åˆ†å±‚å¤Ÿçˆ½å§ï¼Œå…¶å®è¿™ä¹Ÿå°±æ˜¯pagingæˆ–è€…è¯´jetpackç»™æˆ‘ä»¬é¡¹ç›®å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œå±‚å±‚è§£è€¦ï¼Œadapteréƒ½ä¸ç”¨ç»´æŠ¤listæ•°æ®æºäº†ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Fpaging)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fpaging_room)

#### ViewModel

> ViewModel ç±»æ—¨åœ¨ä»¥æ³¨é‡ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼å­˜å‚¨å’Œç®¡ç†ç•Œé¢ç›¸å…³çš„æ•°æ®ã€‚ViewModel ç±»è®©æ•°æ®å¯åœ¨å‘ç”Ÿå±å¹•æ—‹è½¬ç­‰é…ç½®æ›´æ”¹åç»§ç»­ç•™å­˜ã€‚

ç»ˆäºè¯´åˆ°`ViewModel`äº†ï¼Œå…¶å®ä¹‹å‰çš„demoéƒ½ç”¨äº†å¥½å¤šéäº†ï¼Œ`ViewModel`ä¸»è¦æ˜¯ä»ç•Œé¢æ§åˆ¶å™¨é€»è¾‘ä¸­åˆ†ç¦»å‡ºè§†å›¾æ•°æ®ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿä¸»è¦ä¸ºäº†è§£å†³ä¸¤å¤§é—®é¢˜ï¼š

- ä»¥å‰Activityä¸­å¦‚æœè¢«ç³»ç»Ÿé”€æ¯æˆ–è€…éœ€è¦é‡æ–°åˆ›å»ºçš„æ—¶å€™ï¼Œé¡µé¢ä¸´æ—¶æ€§æ•°æ®éƒ½ä¼šä¸¢å¤±ï¼Œéœ€è¦é€šè¿‡`onSaveInstanceState()` æ–¹æ³•ä¿å­˜ï¼ŒonCreateæ–¹æ³•ä¸­è¯»å–ã€‚è€Œä¸”æ•°æ®é‡ä¸€å¤§å°±æ›´åŠ ä¸æ–¹ä¾¿äº†ã€‚
- åœ¨Activityä¸­ï¼Œéš¾å…æœ‰äº›å¼‚æ­¥è°ƒç”¨ï¼Œæ‰€ä»¥å°±ä¼šå®¹æ˜“å¯¼è‡´ç•Œé¢é”€æ¯æ—¶å€™ï¼Œè¿™äº›è°ƒç”¨è¿˜å­˜åœ¨ã€‚é‚£å°±ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼æˆ–è€…ç›´æ¥å´©æºƒã€‚

æ‰€ä»¥`ViewModel`è¯ç”Ÿäº†ï¼Œè¿˜æ˜¯è§£è€¦ï¼Œæˆ‘æŠŠæ•°æ®å•ç‹¬æ‹¿å‡ºæ¥ç®¡ç†ï¼Œè¿˜åŠ ä¸Šç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¸å°±å¯ä»¥è§£å†³è¿™äº›é—®é¢˜äº†å—ã€‚è€Œä¸”å½“æ‰€æœ‰è€… Activity å®Œå…¨é”€æ¯ä¹‹åï¼Œ`ViewModel`ä¼šè°ƒç”¨å…¶`onCleared()`æ–¹æ³•ï¼Œä»¥ä¾¿æ¸…ç†èµ„æºã€‚

æ¥ä¸‹æ¥ä¸¾ä¸ªğŸŒ°ï¼Œçœ‹çœ‹ViewModelå…·ä½“æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼š



```kotlin
def lifecycle_version = "2.2.0"
// ViewModel
implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycle_version"


class SharedViewModel : ViewModel() {
    var userData = MutableLiveData<User>()

    fun select(item: User) {
        userData.value = item
    }

    override fun onCleared() {
        super.onCleared()
    }
}

class MyFragment1 : Fragment() {
    private lateinit var btn: Button

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        val model=activity?.let { ViewModelProvider(it).get(SharedViewModel::class.java) }
        btn.setOnClickListener{
            model?.select(User(0,"bob"))
        }
    }
}

class MyFragment2 : Fragment() {
    private lateinit var btn: Button

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        val model=activity?.let { ViewModelProvider(it).get(SharedViewModel::class.java) }
        model?.userData?.observe(viewLifecycleOwner, Observer<User> { item ->
            // Update the UI
        })
    }
}
    
```

Fragmentä¸­ï¼Œè·å–åˆ°`viewmodel`çš„å®ä¾‹ï¼Œç„¶åè¿›è¡Œæ•°æ®ç›‘å¬ç­‰æ“ä½œã€‚ç­‰ç­‰ï¼Œä½ èƒ½å‘ç°ä»€ä¹ˆä¸ï¼Ÿ
 å¯¹äº†ï¼Œæ•°æ®é€šä¿¡ã€‚ä¸åŒçš„ Fragment å¯ä»¥ä½¿ç”¨å…¶çˆ¶Activityå…±äº«`ViewModel` æ¥è¿›è¡Œæ•°æ®çš„é€šä¿¡ï¼Œå‰å®³å§ã€‚è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç”¨æ³•ï¼Œå»é¡¹ç›®ä¸­æ…¢æ…¢å‘ç°å§ï¼

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Fviewmodel)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fviewmodel)

#### WorkManager

> ä½¿ç”¨ WorkManager API å¯ä»¥è½»æ¾åœ°è°ƒåº¦å³ä½¿åœ¨åº”ç”¨é€€å‡ºæˆ–è®¾å¤‡é‡å¯æ—¶ä»åº”è¿è¡Œçš„å¯å»¶è¿Ÿå¼‚æ­¥ä»»åŠ¡ã€‚

å¬å¬è¿™ä¸ªä»‹ç»å°±å¾ˆç¥å¥‡äº†ï¼Œåº”ç”¨é€€å‡ºå’Œè®¾å¤‡é‡å¯éƒ½èƒ½è‡ªåŠ¨è¿è¡Œï¼Ÿé€šè¿‡å¹¿æ’­ï¼Ÿé‚£æ•°æ®åˆæ˜¯æ€ä¹ˆä¿å­˜çš„å‘¢ï¼Ÿå¬è¯´è¿˜å¯ä»¥æ‰§è¡Œå‘¨æœŸæ€§å¼‚æ­¥ä»»åŠ¡ï¼Œé¡ºåºé“¾å¼è°ƒç”¨å“¦ï¼æ¥ä¸‹æ¥ä¸€ä¸€è§£å¯†

- å…³äºåº”ç”¨é€€å‡ºå’Œè®¾å¤‡é‡å¯
   å¦‚æœAPPæ­£åœ¨è¿è¡Œï¼Œ`WorkManager`ä¼šåœ¨APPè¿›ç¨‹ä¸­èµ·ä¸€ä¸ªæ–°çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ï¼›å¦‚æœAPPæ²¡æœ‰è¿è¡Œï¼Œ`WorkManager`ä¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ–¹å¼æ¥è°ƒåº¦åå°ä»»åŠ¡--æ ¹æ®ç³»ç»Ÿçº§åˆ«å’ŒAPPçŠ¶æ€ï¼ŒWorkManagerå¯èƒ½ä¼šä½¿ç”¨`JobSchedulerï¼ŒFireBase JobDispatcher`æˆ–è€…`AlarmManager`ã€‚
- å…³äºæ•°æ®ä¿å­˜
   `WorkManager`åˆ›å»ºçš„ä»»åŠ¡æ•°æ®éƒ½ä¼šä¿å­˜åˆ°æ•°æ®åº“ï¼Œç”¨çš„æ˜¯`Room`æ¡†æ¶ã€‚ç„¶åé‡å¯ç­‰æ—¶é—´æ®µéƒ½ä¼šå»æ•°æ®åº“å¯»æ‰¾éœ€è¦å®‰æ’æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶ååˆ¤æ–­`çº¦æŸæ¡ä»¶`ï¼Œæ»¡è¶³å³å¯æ‰§è¡Œã€‚

ä¸€èˆ¬è¿™ä¸ªAPIåº”ç”¨åˆ°ä»€ä¹ˆåœºæ™¯å‘¢ï¼Ÿæƒ³æƒ³ï¼Œå¯é è¿è¡Œï¼Œè¿˜å¯ä»¥å‘¨æœŸå¼‚æ­¥ã€‚
 å¯¹äº†ï¼Œå‘é€æ—¥å¿—ã€‚å¯ä»¥é€šè¿‡`WorkManager`è®¾å®šå‘¨æœŸä»»åŠ¡ï¼Œæ¯å¤©æ‰§è¡Œä¸€æ¬¡å‘é€æ—¥å¿—çš„ä»»åŠ¡ã€‚è€Œä¸”èƒ½å¤Ÿä¿è¯ä½ çš„ä»»åŠ¡å¯é è¿è¡Œï¼Œä¸€å®šå¯ä»¥ä¸Šä¼ åˆ°ï¼Œå½“ç„¶ä¹Ÿæ˜¯æ”¯æŒç›‘å¬ä»»åŠ¡ç»“æœç­‰ã€‚ğŸŒ°ï¼š

1ï¼‰**å¯¼å…¥åº“**



```kotlin
    dependencies {
      def work_version = "2.3.4"
        // Kotlin + coroutines
        implementation "androidx.work:work-runtime-ktx:$work_version"

        // optional - RxJava2 support
        implementation "androidx.work:work-rxjava2:$work_version"

        // optional - GCMNetworkManager support
        implementation "androidx.work:work-gcm:$work_version"
      }
    
```

2ï¼‰ **æ–°å»ºä»»åŠ¡ç±»**ï¼Œç»§æ‰¿`Worker`ï¼Œé‡å†™`doWork`æ–¹æ³•ï¼Œè¿”å›ä»»åŠ¡ç»“æœã€‚



```kotlin
class UploadLogcatWork(appContext: Context, workerParams: WorkerParameters) :
    Worker(appContext, workerParams) {

    override fun doWork(): Result {

        if (isUploadLogcatSuc()) {
            return Result.success()
        } else if (isNeedRetry()){
            return Result.retry()
        }

        return Result.failure()
    }

    fun isUploadLogcatSuc(): Boolean {
        var isSuc: Boolean = false
        return isSuc
    }

    fun isNeedRetry(): Boolean {
        var isSuc: Boolean = false
        return isSuc
    }
}
```

3ï¼‰**æœ€åå°±æ˜¯è®¾å®šçº¦æŸ**ï¼ˆæ˜¯å¦éœ€è¦ç½‘ç»œï¼Œæ˜¯å¦æ”¯æŒä½ç”µé‡ï¼Œæ˜¯å¦æ”¯æŒå……ç”µæ‰§è¡Œï¼Œå»¶è¿Ÿç­‰ç­‰ï¼‰ï¼Œæ‰§è¡Œä»»åŠ¡ï¼ˆå•æ¬¡ä»»åŠ¡æˆ–è€…å¾ªç¯å‘¨æœŸä»»åŠ¡ï¼‰



```kotlin
        //è®¾å®šçº¦æŸ
        val constraints =
            Constraints.Builder()
                //ç½‘ç»œé“¾æ¥çš„æ—¶å€™ä½¿ç”¨
                .setRequiredNetworkType(NetworkType.CONNECTED)
                //æ˜¯å¦åœ¨è®¾å¤‡ç©ºé—²çš„æ—¶å€™æ‰§è¡Œ
                .setRequiresDeviceIdle(false)
                //æ˜¯å¦åœ¨ä½ç”µé‡çš„æ—¶å€™æ‰§è¡Œ
                .setRequiresBatteryNotLow(true)
                //æ˜¯å¦åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™æ‰§è¡Œ
                .setRequiresStorageNotLow(true)
                //æ˜¯å¦æ—¶å……ç”µçš„æ—¶å€™æ‰§è¡Œ
                .setRequiresCharging(true)
                //å»¶è¿Ÿæ‰§è¡Œ
                .setTriggerContentMaxDelay(1000 * 1, TimeUnit.MILLISECONDS)
                .build()

        //è®¾å®šå¾ªç¯ä»»åŠ¡
        val uploadRequest =
            PeriodicWorkRequestBuilder<UploadLogcatWork>(1, TimeUnit.HOURS)
                .setConstraints(constraints)
                .addTag("uploadTag")
                .build()

        //æ‰§è¡Œ
        WorkManager.getInstance(applicationContext).enqueue(uploadRequest)


        //ç›‘å¬æ‰§è¡Œç»“æœ
        WorkManager.getInstance(this)
//            .getWorkInfosByTagLiveData("uploadTag") //é€šè¿‡tagæ‹¿åˆ°work
            .getWorkInfoByIdLiveData(uploadRequest.id) //é€šè¿‡idæ‹¿åˆ°work
            .observe(this, Observer {
                it?.apply {
                    when (this.state) {
                        WorkInfo.State.BLOCKED -> println("BLOCKED")
                        WorkInfo.State.CANCELLED -> println("CANCELLED")
                        WorkInfo.State.RUNNING -> println("RUNNING")
                        WorkInfo.State.ENQUEUED -> println("ENQUEUED")
                        WorkInfo.State.FAILED -> println("FAILED")
                        WorkInfo.State.SUCCEEDED -> println("SUCCEEDED")
                        else -> println("else status ${this.state}")
                    }
                }

            })
```

4ï¼‰**å¦å¤–è¿˜æ”¯æŒä»»åŠ¡å–æ¶ˆï¼Œä»»åŠ¡é“¾å¼é¡ºåºè°ƒç”¨ç­‰**



```kotlin
    //å–æ¶ˆ
    fun cancelWork(){
  WorkManager.getInstance(applicationContext).cancelAllWorkByTag("uploadTag")
    }

    fun startLineWork(){
        //å›¾ç‰‡æ»¤é•œ1
        val filter1 = OneTimeWorkRequestBuilder<UploadLogcatWork>()
            .build()
        //å›¾ç‰‡æ»¤é•œ2
        val filter2 = OneTimeWorkRequestBuilder<UploadLogcatWork>()
            .build()
        //å›¾ç‰‡å‹ç¼©
        val compress = OneTimeWorkRequestBuilder<UploadLogcatWork>()
            .build()
        //å›¾ç‰‡ä¸Šä¼ 
        val upload = OneTimeWorkRequestBuilder<UploadLogcatWork>()
            .build()

        WorkManager.getInstance(applicationContext)
            .beginWith(listOf(filter1, filter2))
            .then(compress)
            .then(upload)
            .enqueue()
    }
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Fworkmanager)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fworkmanager)

### Jetpack-è¡Œä¸ºç»„ä»¶

#### CameraX

> CameraX æ˜¯ä¸€ä¸ª Jetpack æ”¯æŒåº“ï¼Œæ—¨åœ¨å¸®åŠ©æ‚¨ç®€åŒ–ç›¸æœºåº”ç”¨çš„å¼€å‘å·¥ä½œã€‚å®ƒæä¾›ä¸€è‡´ä¸”æ˜“äºä½¿ç”¨çš„ API Surfaceï¼Œé€‚ç”¨äºå¤§å¤šæ•° Android è®¾å¤‡ï¼Œå¹¶å¯å‘åå…¼å®¹è‡³ Android 5.0ï¼ˆAPI çº§åˆ« 21ï¼‰ã€‚
>  è™½ç„¶å®ƒåˆ©ç”¨çš„æ˜¯ camera2 çš„åŠŸèƒ½ï¼Œä½†ä½¿ç”¨çš„æ˜¯æ›´ä¸ºç®€å•ä¸”åŸºäºç”¨ä¾‹çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ã€‚å®ƒè¿˜è§£å†³äº†è®¾å¤‡å…¼å®¹æ€§é—®é¢˜ï¼Œå› æ­¤æ‚¨æ— éœ€åœ¨ä»£ç åº“ä¸­æ·»åŠ è®¾å¤‡ä¸“å±ä»£ç ã€‚è¿™äº›åŠŸèƒ½å‡å°‘äº†å°†ç›¸æœºåŠŸèƒ½æ·»åŠ åˆ°åº”ç”¨æ—¶éœ€è¦ç¼–å†™çš„ä»£ç é‡ã€‚

æƒ³å¿…å¤§å®¶éƒ½äº†è§£è¿‡`Camera API`å’Œ`Camera2 API`ï¼Œæ€»ç»“å°±æ˜¯ä¸¤ä¸ªå­—ï¼Œä¸å¥½ç”¨ã€‚å“ˆå“ˆï¼Œè‡ªæˆ‘æ„Ÿè§‰ï¼Œåœ¨æˆ‘å°è±¡ä¸­ï¼Œæˆ‘è¦ç…§ç›¸æ‹ä¸€å¼ ç…§ç‰‡ï¼Œä¸æ˜¯åº”è¯¥ç›´æ¥è°ƒç”¨ä¸€å¥ä»£ç å¯ä»¥å®Œæˆå—ã€‚ä½†æ˜¯ç”¨ä¹‹å‰çš„APIï¼Œæˆ‘éœ€è¦å»ç®¡ç†ç›¸æœºå®ä¾‹ï¼Œè®¾ç½®SufraceViewç›¸å…³çš„å„ç§ä¸œè¥¿ï¼Œè¿˜æœ‰é¢„è§ˆå°ºå¯¸å’Œå›¾åƒå°ºå¯¸ï¼Œå¤„ç†è®¾ç½®å„ç§ç›‘å¬ç­‰ç­‰ï¼Œå¤´å·²æ™•ã€‚

å¯èƒ½æ˜¯å®˜æ–¹å¬åˆ°äº†æˆ‘çš„æŠ±æ€¨ï¼Œäºæ˜¯`CameraX`æ¥äº†ï¼ŒCameraXæ˜¯åŸºäº`camera2`è¿›è¡Œäº†å°è£…ï¼Œç»™æˆ‘ä»¬æä¾›äº†æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆæ¥è§£å†³æˆ‘ä»¬ä¹‹å‰çš„å›°å¢ƒã€‚ğŸŒ°æ¥äº†



```kotlin
    // CameraX core library using the camera2 implementation
    def camerax_version = "1.0.0-beta06"
    // The following line is optional, as the core library is included indirectly by camera-camera2
    implementation "androidx.camera:camera-core:${camerax_version}"
    implementation "androidx.camera:camera-camera2:${camerax_version}"
    // If you want to additionally use the CameraX Lifecycle library
    implementation "androidx.camera:camera-lifecycle:${camerax_version}"
    // If you want to additionally use the CameraX View class
    implementation "androidx.camera:camera-view:1.0.0-alpha13"
    // If you want to additionally use the CameraX Extensions library
    implementation "androidx.camera:camera-extensions:1.0.0-alpha13"
    
    
    <uses-permission android:name="android.permission.CAMERA" />
    
    //åˆå§‹åŒ–ç›¸æœº
    private fun initCamera() {
        val cameraProviderFuture = ProcessCameraProvider.getInstance(this)
        cameraProviderFuture.addListener(Runnable {
            try {
                val cameraProvider = cameraProviderFuture.get()
                val preview = Preview.Builder().build()


                //å›¾ç‰‡æ‹æ‘„ç”¨ä¾‹
                mImageCapture = ImageCapture.Builder()
                    .setFlashMode(ImageCapture.FLASH_MODE_AUTO)
                    .build()

                //é…ç½®å‚æ•°ï¼ˆåç½®æ‘„åƒå¤´ç­‰ï¼‰
                // Choose the camera by requiring a lens facing
                val cameraSelector =
                    CameraSelector.Builder().requireLensFacing(CameraSelector.LENS_FACING_FRONT)
                        .build()

                //æŒ‡å®šè¦ä¸ç›¸æœºå…³è”çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¯¥ç”Ÿå‘½å‘¨æœŸä¼šå‘ŠçŸ¥ CameraX ä½•æ—¶é…ç½®ç›¸æœºæ‹æ‘„ä¼šè¯å¹¶ç¡®ä¿ç›¸æœºçŠ¶æ€éšç”Ÿå‘½å‘¨æœŸçš„è½¬æ¢ç›¸åº”åœ°æ›´æ”¹ã€‚
                val camera: Camera = cameraProvider.bindToLifecycle(
                    this,
                    cameraSelector,
                    preview,
                    mImageCapture
                )

                //ç›¸æœºé¢„è§ˆ
                preview.setSurfaceProvider(view_finder.createSurfaceProvider())

            } catch (e: java.lang.Exception) {
                e.printStackTrace()
            }
        }, ContextCompat.getMainExecutor(this))
    }

    //æ‹ç…§å¹¶ä¿å­˜
    fun takePhoto(view: View?) {
        if (mImageCapture != null) {
            val outputFileOptions: OutputFileOptions = OutputFileOptions.Builder(cretaeFile()).build()

            //æ‹ç…§
            mImageCapture?.takePicture(
                outputFileOptions,
                ContextCompat.getMainExecutor(this),
                object : ImageCapture.OnImageSavedCallback {
                    override fun onImageSaved(@NonNull outputFileResults: OutputFileResults) {
                        //ä¿å­˜æˆåŠŸ
                        Log.e(TAG, "success")
                    }

                    override fun onError(@NonNull exception: ImageCaptureException) {
                        //ä¿å­˜å¤±è´¥
                        Log.e(TAG, "fail")
                    }
                })
        }
    }    
```

ä½¿ç”¨èµ·æ¥æŒºæ–¹ä¾¿å§ï¼Œè€Œä¸”å¯ä»¥ç»‘å®šå½“å‰activityçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™å°±æ¶‰åŠåˆ°å¦å¤–ä¸€ä¸ªç»„ä»¶`Lifecycle`äº†ï¼Œé€šè¿‡ä¸€æ¬¡ç»‘å®šäº‹ä»¶ï¼Œå°±å¯ä»¥ä½¿ç›¸æœºçŠ¶æ€éšç”Ÿå‘½å‘¨æœŸçš„è½¬æ¢ç›¸åº”åœ°æ›´æ”¹ã€‚
 å¦å¤–è¦æ³¨æ„çš„æ˜¯å…ˆè·å–ç›¸æœºæƒé™å“¦ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftraining%2Fcamerax)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fcamerax)

#### ä¸‹è½½ç®¡ç†å™¨

> DownloadManagerä¸‹è½½ç®¡ç†å™¨æ˜¯ä¸€ä¸ªå¤„ç†é•¿æ—¶é—´è¿è¡Œçš„HTTPä¸‹è½½çš„ç³»ç»ŸæœåŠ¡ã€‚å®¢æˆ·ç«¯å¯ä»¥è¯·æ±‚å°†URIä¸‹è½½åˆ°ç‰¹å®šçš„ç›®æ ‡æ–‡ä»¶ã€‚ä¸‹è½½ç®¡ç†å™¨å°†åœ¨åå°æ‰§è¡Œä¸‹è½½ï¼Œè´Ÿè´£HTTPäº¤äº’ï¼Œå¹¶åœ¨å¤±è´¥æˆ–è·¨è¿æ¥æ›´æ”¹å’Œç³»ç»Ÿé‡å¯åé‡è¯•ä¸‹è½½ã€‚

`DownloadManager`ï¼Œå¤§å®¶åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰å§ï¼Œ`android2.3`å°±å¼€é€šæä¾›çš„APIï¼Œå¾ˆæ–¹ä¾¿å°±å¯ä»¥ä¸‹è½½æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯ä»¥è®¾ç½®æ˜¯å¦é€šçŸ¥æ˜¾ç¤ºï¼Œä¸‹è½½æ–‡ä»¶å¤¹åï¼Œæ–‡ä»¶åï¼Œä¸‹è½½è¿›åº¦çŠ¶æ€æŸ¥è¯¢ç­‰ç­‰ã€‚ğŸŒ°æ¥



```kotlin
class DownloadActivity : AppCompatActivity() {

    private var mDownId: Long = 0
    private var mDownloadManager: DownloadManager? = null
    private val observer: DownloadContentObserver = DownloadContentObserver()


    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
    }

    //é…ç½®ä¸‹è½½å‚æ•°ï¼Œenqueueå¼€å§‹ä¸‹è½½
    fun download(url: String) {
        mDownloadManager =
            this.getSystemService(Context.DOWNLOAD_SERVICE) as DownloadManager
        val request = DownloadManager.Request(Uri.parse(url))
        // è®¾ç½®æ–‡ä»¶å¤¹æ–‡ä»¶å
        request.setDestinationInExternalPublicDir("lz_download", "test.apk")
        // è®¾ç½®å…è®¸çš„ç½‘ç»œç±»å‹
        request.setAllowedNetworkTypes(DownloadManager.Request.NETWORK_WIFI)
        // æ–‡ä»¶ç±»å‹
        request.setMimeType("application/zip")
        // è®¾ç½®é€šçŸ¥æ˜¯å¦æ˜¾ç¤º
        request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED)
        //è®¾ç½®é€šçŸ¥æ æ ‡é¢˜
        request.setTitle("apk download")
        //è®¾ç½®é€šçŸ¥æ å†…å®¹
        request.setDescription("*** apk")

        mDownId = mDownloadManager!!.enqueue(request)

 contentResolver.registerContentObserver(mDownloadManager!!.getUriForDownloadedFile(mDownId), true, observer)
    }

    //é€šè¿‡ContentProvideræŸ¥è¯¢ä¸‹è½½æƒ…å†µ
    fun queryDownloadStatus(){
        val query = DownloadManager.Query()
        //é€šè¿‡ä¸‹è½½çš„idæŸ¥æ‰¾
        //é€šè¿‡ä¸‹è½½çš„idæŸ¥æ‰¾
        query.setFilterById(mDownId)
        val cursor: Cursor = mDownloadManager!!.query(query)
        if (cursor.moveToFirst()) {
            // å·²ä¸‹è½½å­—èŠ‚æ•°
            val downloadBytes = cursor.getInt(cursor.getColumnIndexOrThrow(DownloadManager.COLUMN_BYTES_DOWNLOADED_SO_FAR))
            // æ€»å­—èŠ‚æ•°
            val allBytes= cursor.getInt(cursor.getColumnIndexOrThrow(DownloadManager.COLUMN_TOTAL_SIZE_BYTES))
            // çŠ¶æ€
            when (cursor.getInt(cursor.getColumnIndex(DownloadManager.COLUMN_STATUS))) {
                DownloadManager.STATUS_PAUSED -> {
                }
                DownloadManager.STATUS_PENDING -> {
                }
                DownloadManager.STATUS_RUNNING -> {
                }
                DownloadManager.STATUS_SUCCESSFUL -> {
                    cursor.close()
                }
                DownloadManager.STATUS_FAILED -> {
                    cursor.close()
                }
            }

        }
    }

    //å–æ¶ˆä¸‹è½½ï¼Œåˆ é™¤æ–‡ä»¶
    fun unDownLoad(view: View?) {
        mDownloadManager!!.remove(mDownId)
    }


    override fun onDestroy() {
        super.onDestroy()
        contentResolver.unregisterContentObserver(observer)
    }


    //ç›‘å¬ä¸‹è½½æƒ…å†µ
    inner class DownloadContentObserver : ContentObserver(Handler(Looper.getMainLooper())) {
        override fun onChange(selfChange: Boolean) {
            queryDownloadStatus()
        }
    }

}
```

demoåº”è¯¥å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œè¦æ³¨æ„çš„å°±æ˜¯ä¿å­˜ä¸‹è½½idï¼Œåç»­å–æ¶ˆä¸‹è½½ï¼ŒæŸ¥è¯¢ä¸‹è½½è¿›åº¦çŠ¶æ€éƒ½æ˜¯é€šè¿‡è¿™ä¸ªidæ¥æŸ¥è¯¢ã€‚ç›‘å¬ä¸‹è½½è¿›åº¦ä¸»è¦æ˜¯é€šè¿‡è§‚å¯Ÿ`getUriForDownloadedFile`æ–¹æ³•è¿”å›çš„uriï¼Œè§‚å¯Ÿè¿™ä¸ªuriæŒ‡å‘çš„æ•°æ®åº“å˜åŒ–æ¥è·å–è¿›åº¦ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Freference%2Fandroid%2Fapp%2FDownloadManager)         
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fdownloadmanager)

#### åª’ä½“å’Œæ’­æ”¾

> Android å¤šåª’ä½“æ¡†æ¶æ”¯æŒæ’­æ”¾å„ç§å¸¸è§åª’ä½“ç±»å‹ï¼Œä»¥ä¾¿æ‚¨è½»æ¾åœ°å°†éŸ³é¢‘ã€è§†é¢‘å’Œå›¾ç‰‡é›†æˆåˆ°åº”ç”¨ä¸­ã€‚

è¿™é‡Œåª’ä½“å’Œæ’­æ”¾æŒ‡çš„æ˜¯éŸ³é¢‘è§†é¢‘ç›¸å…³å†…å®¹ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªç›¸å…³ç±»ï¼š

- `MediaPlayer`
- `ExoPlayer`

`MediaPlayer`ä¸ç”¨è¯´äº†ï¼Œåº”è¯¥æ‰€æœ‰äººéƒ½ç”¨è¿‡å§ï¼Œå¾…ä¼šå°±é¡ºä¾¿æä¸€å˜´ã€‚
 `ExoPlayer`æ˜¯ä¸€ä¸ªå•ç‹¬çš„åº“ï¼Œä¹Ÿæ˜¯googleå¼€æºçš„åª’ä½“æ’­æ”¾å™¨é¡¹ç›®ï¼Œå¬è¯´æ˜¯Youtube APPæ‰€ä½¿ç”¨çš„æ’­æ”¾å™¨ï¼Œæ‰€ä»¥ä»–çš„åŠŸèƒ½ä¹Ÿæ˜¯è¦æ¯”`MediaPlayer`å¼ºå¤§ï¼Œæ”¯æŒå„ç§è‡ªå®šä¹‰ï¼Œå¯ä»¥ä¸`IJKPlayer`åª²ç¾ï¼Œåªæ˜¯ä½¿ç”¨èµ·æ¥æ¯”è¾ƒå¤æ‚ã€‚

1ï¼‰**MediaPlayer**



```kotlin
        //æ’­æ”¾æœ¬åœ°æ–‡ä»¶
        var mediaPlayer: MediaPlayer? = MediaPlayer.create(this, R.raw.test_media)
        mediaPlayer?.start()

        //è®¾ç½®æ’­æ”¾ä¸æ¯å± é…åˆæƒé™WAKE_LOCKä½¿ç”¨
        mediaPlayer?.setScreenOnWhilePlaying(true)


        //æ’­æ”¾æœ¬åœ°æœ¬åœ°å¯ç”¨çš„ URI
        val myUri: Uri = Uri.EMPTY
        val mediaPlayer2: MediaPlayer? = MediaPlayer().apply {
            setAudioStreamType(AudioManager.STREAM_MUSIC)
            setDataSource(applicationContext, myUri)
            prepare()
            start()
        }

        //æ’­æ”¾ç½‘ç»œæ–‡ä»¶
        val url = "http://........"
        val mediaPlayer3: MediaPlayer? = MediaPlayer().apply {
            setAudioStreamType(AudioManager.STREAM_MUSIC)
            setDataSource(url)
            prepare()
            start()
        }


        //é‡Šæ”¾
        mediaPlayer?.release()
        mediaPlayer = null
    
```

2ï¼‰**ExoPlayer**



```kotlin
   compile 'com.google.android.exoplayer:exoplayer:r2.X.X'
   
    var player: SimpleExoPlayer ?= null

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_exoplayer)

        //åˆå§‹åŒ–
        player = SimpleExoPlayer.Builder(this).build()
        video_view.player = player
        player?.playWhenReady = true

        //è®¾ç½®æ’­æ”¾èµ„æº
        val dataSourceFactory: DataSource.Factory = DefaultDataSourceFactory(
            this,
            Util.getUserAgent(this, "yourApplicationName")
        )
        val uri: Uri = Uri.EMPTY
        val videoSource: MediaSource = ProgressiveMediaSource.Factory(dataSourceFactory)
            .createMediaSource(uri)
        player?.prepare(videoSource)
    }

    private fun releasePlayer() {
        //é‡Šæ”¾
        player?.release()
        player = null
    }
```

å¥½åƒä¹Ÿä¸å¤æ‚ï¼Ÿå“ˆå“ˆï¼Œæ›´å¼ºå¤§çš„åŠŸèƒ½éœ€è¦ä½ å»å‘ç°ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Ftopics%2Fmedia-apps%2Fmedia-apps-overview)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fmedia)

#### é€šçŸ¥

> é€šçŸ¥æ˜¯æŒ‡ Android åœ¨åº”ç”¨çš„ç•Œé¢ä¹‹å¤–æ˜¾ç¤ºçš„æ¶ˆæ¯ï¼Œæ—¨åœ¨å‘ç”¨æˆ·æä¾›æé†’ã€æ¥è‡ªä»–äººçš„é€šä¿¡ä¿¡æ¯æˆ–åº”ç”¨ä¸­çš„å…¶ä»–å®æ—¶ä¿¡æ¯ã€‚ç”¨æˆ·å¯ä»¥ç‚¹æŒ‰é€šçŸ¥æ¥æ‰“å¼€åº”ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨é€šçŸ¥ä¸­æ‰§è¡ŒæŸé¡¹æ“ä½œã€‚

è¿™ä¸ªåº”è¯¥éƒ½äº†è§£ï¼Œç›´æ¥ä¸Šä¸ªğŸŒ°



```kotlin
    private fun createNotificationChannel() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            val name = "mychannel"
            val descriptionText = "for test"
            val importance = NotificationManager.IMPORTANCE_DEFAULT
            val channel = NotificationChannel(CHANNEL_ID, name, importance).apply {
                description = descriptionText
            }
            // Register the channel with the system
            val notificationManager: NotificationManager =
                getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
            notificationManager.createNotificationChannel(channel)
        }
    }

    private fun showNotification(){
        val intent = Intent(this, SettingActivity::class.java).apply {
            flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK
        }
        val pendingIntent: PendingIntent = PendingIntent.getActivity(this, 0, intent, 0)

        val builder = NotificationCompat.Builder(this, CHANNEL_ID)
            .setSmallIcon(R.drawable.ic_launcher_foreground)
            .setContentTitle("My notification")
            .setContentText("Hello World!")
            .setPriority(NotificationCompat.PRIORITY_DEFAULT)
            // Set the intent that will fire when the user taps the notification
            .setContentIntent(pendingIntent)
            .setAutoCancel(true)

        with(NotificationManagerCompat.from(this)) {
            notify(1, builder.build())
        }

    }
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Ftopics%2Fui%2Fnotifiers%2Fnotifications)

#### æƒé™

> æƒé™çš„ä½œç”¨æ˜¯ä¿æŠ¤ Android ç”¨æˆ·çš„éšç§ã€‚Android åº”ç”¨å¿…é¡»è¯·æ±‚æƒé™æ‰èƒ½è®¿é—®æ•æ„Ÿçš„ç”¨æˆ·æ•°æ®ï¼ˆä¾‹å¦‚è”ç³»äººå’ŒçŸ­ä¿¡ï¼‰ä»¥åŠæŸäº›ç³»ç»ŸåŠŸèƒ½ï¼ˆä¾‹å¦‚ç›¸æœºå’Œäº’è”ç½‘ï¼‰ã€‚ç³»ç»Ÿå¯èƒ½ä¼šè‡ªåŠ¨æˆäºˆæƒé™ï¼Œä¹Ÿå¯èƒ½ä¼šæç¤ºç”¨æˆ·æ‰¹å‡†è¯·æ±‚ï¼Œå…·ä½“å–å†³äºè®¿é—®çš„åŠŸèƒ½ã€‚

æƒé™å¤§å®¶åº”è¯¥ä¹Ÿéƒ½å¾ˆç†Ÿæ‚‰äº†ã€‚

- å±é™©æƒé™ã€‚6.0ä»¥åä½¿ç”¨å±é™©æƒé™éœ€è¦ç”³è¯·ï¼Œæ¨è[RxPermissionsåº“](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Ftbruyelle%2FRxPermissions)
- å¯é€‰ç¡¬ä»¶åŠŸèƒ½çš„æƒé™ã€‚ å¯¹äºä½¿ç”¨ç¡¬ä»¶çš„åº”ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨äº†ç›¸æœºï¼Œå¦‚æœä½ æƒ³è®©`Google Play`å…è®¸å°†ä½ çš„åº”ç”¨å®‰è£…åœ¨æ²¡æœ‰è¯¥åŠŸèƒ½çš„è®¾å¤‡ä¸Šï¼Œå°±è¦é…ç½®ç¡¬ä»¶åŠŸèƒ½çš„æƒé™ä¸ºä¸å¿…é¡»çš„ï¼š<uses-feature android:name="android.hardware.camera" android:required="false" />
- è‡ªå®šä¹‰æƒé™ã€‚è¿™ä¸ªå¯èƒ½æœ‰äº›åŒå­¦æ²¡æ¥è§¦è¿‡ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®Activityçš„`exported`å±æ€§ä¸ºtrueï¼Œåˆ«äººå°±èƒ½é€šè¿‡åŒ…åå’ŒActivityåè®¿é—®æˆ‘ä»¬çš„Activtyï¼Œé‚£å¦‚æœæˆ‘ä»¬åˆä¸æƒ³è®©æ‰€æœ‰äººéƒ½èƒ½è®¿é—®æˆ‘è¿™ä¸ªActivtyå‘¢?å¯ä»¥é€šè¿‡`è‡ªå®šä¹‰æƒé™`å®ç°ã€‚ğŸŒ°æ¥



```kotlin
//åº”ç”¨A
<manifest
  xmlns:android="http://schemas.android.com/apk/res/android"
  package="com.test.myapp" >
    
    <permission
      android:name="com.test.myapp.permission.DEADLY_ACTIVITY"
      android:permissionGroup="android.permission-group.COST_MONEY"
      android:protectionLevel="dangerous" />
    
     <activity
            android:name="MainActivity"
            android:exported="true" 
            android:permission="com.test.myapp.permission.DEADLY_ACTIVITY">
       </activity>
</manifest>

//åº”ç”¨B
<manifest
  xmlns:android="http://schemas.android.com/apk/res/android"
  package="com.test.otherapp" >
    
    <uses-permission android:name="com.test.myapp.permission.DEADLY_ACTIVITY" />
</manifest>
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Ftopics%2Fpermissions)

#### åå¥½è®¾ç½®

> å»ºè®®ä½¿ç”¨ AndroidX Preference Library å°†ç”¨æˆ·å¯é…ç½®è®¾ç½®é›†æˆè‡³æ‚¨çš„åº”ç”¨ä¸­ã€‚æ­¤åº“ç®¡ç†ç•Œé¢ï¼Œå¹¶ä¸å­˜å‚¨ç©ºé—´äº¤äº’ï¼Œå› æ­¤æ‚¨åªéœ€å®šä¹‰ç”¨æˆ·å¯ä»¥é…ç½®çš„å•ç‹¬è®¾ç½®ã€‚æ­¤åº“è‡ªå¸¦ Material ä¸»é¢˜ï¼Œå¯åœ¨ä¸åŒçš„è®¾å¤‡å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¹‹é—´æä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚

å¼€å§‹çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜æˆ‘æ˜¯æ‡µé€¼çš„ï¼Œè®¾ç½®ï¼Ÿæˆ‘çš„è®¾ç½®é¡µå®˜æ–¹éƒ½å¯ä»¥å¸®æˆ‘å†™äº†ï¼Ÿç„¶åæˆ‘å°±å»ç ”ç©¶äº†`Preferenceåº“`ï¼Œå˜¿ï¼Œè¿˜çœŸæ˜¯ï¼Œå¦‚æœä½ çš„Appæœ¬èº«å°±æ˜¯`Materialé£æ ¼`ï¼Œå°±å¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªäº†ã€‚ä½†æ˜¯ä¹Ÿæ­£æ˜¯ç”±äºé£æ ¼å›ºå®šï¼Œåœ¨å®é™…å¤šæ ·çš„APPä¸­åº”ç”¨æ¯”è¾ƒå°‘ã€‚
 æ¥ä¸ªğŸŒ°



```kotlin
   implementation 'androidx.preference:preference:1.1.0-alpha04'
   
   //res-xml-setting.xml
   <?xml version="1.0" encoding="utf-8"?>
<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto">

    <PreferenceCategory
        app:key="notifications_category"
        app:title="Notifications">
        <SwitchPreferenceCompat
            app:key="notifications"
            app:title="Enable message notifications" />
    </PreferenceCategory>

    <PreferenceCategory
        app:key="help_category"
        app:title="Help">
        <Preference
            app:key="feedback"
            app:summary="Report technical issues or suggest new features"
            app:title="Send feedback" />

        <Preference
            app:key="webpage"
            app:title="View webpage">
            <intent
                android:action="android.intent.action.VIEW"
                android:data="http://www.baidu.com" />
        </Preference>
    </PreferenceCategory>
</PreferenceScreen>


class SettingFragment : PreferenceFragmentCompat() {
    override fun onCreatePreferences(savedInstanceState: Bundle?, rootKey: String?) {
        setPreferencesFromResource(R.xml.setting, rootKey)
        val feedbackPreference: Preference? = findPreference("feedback")

        feedbackPreference?.setOnPreferenceClickListener {
            Toast.makeText(context,"hello Setting",Toast.LENGTH_SHORT).show()
            true
        }
    }
}


class SettingActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_setting)

        supportFragmentManager
            .beginTransaction()
            .replace(R.id.settings_container, SettingFragment())
            .commit()
    }
    
}
   
```

é¦–å…ˆæ–°å»º`xml`æ–‡ä»¶ï¼Œä¹Ÿå°±ç›¸å½“äºè®¾ç½®é¡µçš„å¸ƒå±€äº†ï¼ŒåŒ…æ‹¬é‚£äº›åˆ†ç±»ï¼Œé‚£äº›é€‰é¡¹ï¼Œä»¥åŠé€‰é¡¹çš„åŠŸèƒ½ã€‚
 ç„¶åæ–°å»º`fragment`ç»§æ‰¿è‡ª`PreferenceFragmentCompat`ï¼Œè¿™é‡Œå°±å¯ä»¥ç»‘å®šxmlæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®ç‚¹å‡»äº‹ä»¶ã€‚
 æœ€åå°†fragmentåŠ åˆ°Activityå³å¯ã€‚âœŒï¸

æ¥å¼ æ•ˆæœå›¾çœ‹çœ‹



![img](https:////upload-images.jianshu.io/upload_images/8690467-e32f004824488ce3.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/1080/format/webp)

jetpack-setting.jpg

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Ftopics%2Fui%2Fsettings)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fsetting)

#### å…±äº«

> Android åº”ç”¨çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯å®ƒä»¬èƒ½å¤Ÿäº’ç›¸é€šä¿¡å’Œé›†æˆã€‚å¦‚æœæŸä¸€åŠŸèƒ½å¹¶éåº”ç”¨çš„æ ¸å¿ƒï¼Œè€Œä¸”å·²å­˜åœ¨äºå¦ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œä¸ºä½•è¦é‡æ–°å¼€å‘å®ƒï¼Ÿ

è¿™é‡Œçš„å…±äº«ä¸»è¦æŒ‡çš„æ˜¯`åº”ç”¨é—´çš„å…±äº«`ï¼Œæ¯”å¦‚å‘é‚®ä»¶åŠŸèƒ½ï¼Œæ‰“å¼€ç½‘é¡µåŠŸèƒ½ï¼Œè¿™äº›æˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥è°ƒç”¨ç³»ç»Ÿåº”ç”¨æˆ–è€…å…¶ä»–ä¸‰æ–¹åº”ç”¨æ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™äº›åŠŸèƒ½ï¼Œè¿™ä¹Ÿå°±æ˜¯å…±äº«çš„æ„ä¹‰ã€‚



```kotlin
    //å‘é€æ–¹
    val sendIntent: Intent = Intent().apply {
        action = Intent.ACTION_SEND
        putExtra(Intent.EXTRA_TEXT, "This is my text to send.")
        type = "text/plain"
    }

    val shareIntent = Intent.createChooser(sendIntent, null)
    startActivity(shareIntent)
    
    //æ¥æ”¶æ–¹
    <activity android:name=".ui.MyActivity" >
        <intent-filter>
            <action android:name="android.intent.action.SEND" />
            <category android:name="android.intent.category.DEFAULT" />
            <data android:mimeType="text/plain" />
        </intent-filter>
    </activity>
        
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftraining%2Fsharing)

#### åˆ‡ç‰‡

> åˆ‡ç‰‡æ˜¯ç•Œé¢æ¨¡æ¿ï¼Œå¯ä»¥åœ¨ Google æœç´¢åº”ç”¨ä¸­ä»¥åŠ Google åŠ©ç†ä¸­ç­‰å…¶ä»–ä½ç½®æ˜¾ç¤ºæ‚¨åº”ç”¨ä¸­çš„ä¸°å¯Œè€ŒåŠ¨æ€çš„äº’åŠ¨å†…å®¹ã€‚åˆ‡ç‰‡æ”¯æŒå…¨å±åº”ç”¨ä½“éªŒä¹‹å¤–çš„äº’åŠ¨ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¿«åœ°æ‰§è¡Œä»»åŠ¡ã€‚æ‚¨å¯ä»¥å°†åˆ‡ç‰‡æ„å»ºæˆä¸ºåº”ç”¨æ“ä½œçš„å¢å¼ºåŠŸèƒ½ã€‚

è¿™ä¸ªä»‹ç»ç¡®å®æœ‰ç‚¹æ¨¡ç³Šï¼Œä½†æ˜¯è¯´åˆ°`Slice`ä½ ä¼šä¸ä¼šæœ‰ç‚¹å°è±¡ï¼Ÿ2018å¹´Google I/0å®£å¸ƒæ¨å‡ºæ–°çš„ç•Œé¢æ“ä½œ`Action & Slice`ã€‚è€Œè¿™ä¸ªSliceå°±æ˜¯è¿™é‡Œè¯´çš„åˆ‡ç‰‡ã€‚ä»–èƒ½åšä»€ä¹ˆå‘¢ï¼Ÿå¯ä»¥è®©ä½¿ç”¨è€…èƒ½å¿«é€Ÿä½¿ç”¨åˆ° app é‡Œçš„æŸä¸ªç‰¹å®šåŠŸèƒ½ã€‚åªè¦å¼€å‘è€…å¯¼å…¥ Slice åŠŸèƒ½ï¼Œä½¿ç”¨è€…åœ¨ä½¿ç”¨æœå¯»ã€Google Play å•†åº—ã€Google Assitantæˆ–å…¶ä»–å†…å»ºåŠŸèƒ½æ—¶éƒ½ä¼šå‡ºç° `Slice` çš„æ“ä½œå»ºè®®ã€‚

è¯´ç™½äº†å°±æ˜¯ä½ çš„åº”ç”¨ä¸€äº›åŠŸèƒ½å¯ä»¥åœ¨å…¶ä»–çš„åº”ç”¨æ˜¾ç¤ºå’Œæ“ä½œã€‚

æ‰€ä»¥ï¼Œå¦‚æœä½ çš„åº”ç”¨å‘å¸ƒåœ¨`GooglePlay`çš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥äº†è§£å­¦ä¹ ä¸‹Sliceç›¸å…³å†…å®¹ï¼Œæ¯•ç«Ÿæ˜¯Googleä¸ºäº†åº”ç”¨è½»ä¾¿æ€§åšå‡ºçš„åˆä¸€æ­¥å®éªŒã€‚

æ€ä¹ˆå¼€å‘è¿™ä¸ªåŠŸèƒ½å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€æ­¥ï¼Œå³é”®`Newâ€”otherâ€”Slice Provider`å°±å¯ä»¥äº†ã€‚
 sliceåº“ï¼Œproviderå’ŒSliceProviderç±»éƒ½é…ç½®å¥½äº†ï¼Œæ–¹ä¾¿å§ã€‚è´´ä¸‹ä»£ç ï¼š



```kotlin
     <provider
          android:name=".slice.MySliceProvider"
          android:authorities="com.panda.jetpackdemo.slice"
          android:exported="true">
          <intent-filter>
            <action android:name="android.intent.action.VIEW" />
            <category android:name="android.app.slice.category.SLICE" />
                <data
                    android:host="panda.com"
                    android:pathPrefix="/"
                    android:scheme="http" />
            </intent-filter>
        </provider>
        
        
class MySliceProvider : SliceProvider() {
    /**
     * Construct the Slice and bind data if available.
     * åˆ‡ç‰‡åŒ¹é…
     */
    override fun onBindSlice(sliceUri: Uri): Slice? {
        val context = context ?: return null
        val activityAction = createActivityAction() ?: return null
        return if (sliceUri.path.equals("/hello") ) {
            Log.e("lz6","222")
            ListBuilder(context, sliceUri, ListBuilder.INFINITY)
                .addRow(
                    ListBuilder.RowBuilder()
                        .setTitle("Hello World")
                        .setPrimaryAction(activityAction)
                )
                .build()
        } else {
            // Error: Path not found.
            ListBuilder(context, sliceUri, ListBuilder.INFINITY)
                .addRow(
                    ListBuilder.RowBuilder()
                        .setTitle("URI not found.")
                        .setPrimaryAction(activityAction)
                )
                .build()
        }
    }

    //åˆ‡ç‰‡ç‚¹å‡»äº‹ä»¶
    private fun createActivityAction(): SliceAction? {
        return SliceAction.create(
            PendingIntent.getActivity(
                context, 0, Intent(context, SettingActivity::class.java), 0
            ),
            IconCompat.createWithResource(context, R.drawable.ic_launcher_foreground),
            ListBuilder.ICON_IMAGE,
            "Open App"
        )
    }

}
        
```

å¦‚ä¸Šå°±æ˜¯åˆ‡ç‰‡çš„é‡è¦ä»£ç ï¼Œå…¶ä¸­`onBindSlice`æ˜¯ç”¨æ¥åŒ¹é…uriçš„ï¼Œæ¯”å¦‚ä¸Šè¿°å¦‚æœuriä¸º/helloå°±æ˜¾ç¤ºä¸€ä¸ªListBuilderã€‚`createActivityAction`æ–¹æ³•åˆ™æ˜¯å“åº”åˆ‡ç‰‡ç‚¹å‡»äº‹ä»¶çš„ã€‚
 å¯ä»¥çœ‹åˆ°åœ¨AndroidManifest.xmlä¸­æ˜¯é€šè¿‡`provider`é…ç½®çš„ï¼Œæ‰€ä»¥è¿™ä¸ªåˆ‡ç‰‡çš„åŸç†å°±æ˜¯é€šè¿‡`ContentProvider`å½¢å¼ï¼Œè®©å¤–éƒ¨å¯ä»¥è®¿é—®è¿™ä¸ªproviderï¼Œç„¶åå“åº”ç›¸å…³äº‹ä»¶æˆ–è€…æ˜¾ç¤ºç›¸å…³çš„viewã€‚

å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æµ‹è¯•åˆ‡ç‰‡ä½¿ç”¨äº†ï¼Œå®Œæ•´çš„åˆ‡ç‰‡URIæ˜¯`slice-content://{authorities}/{action}`ï¼Œæ‰€ä»¥è¿™é‡Œå¯¹åº”çš„å°±æ˜¯`slice-content://com.panda.jetpackdemo.slice/hello`ã€‚

åˆåœ¨å“ªé‡Œå¯ä»¥ä½¿ç”¨å‘¢ï¼Ÿå®˜æ–¹æä¾›äº†ä¸€ä¸ªå¯ä¾›æµ‹è¯•çš„appâ€”[slice-viewer](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fandroid%2Fuser-interface-samples%2Freleases)ã€‚
 ä¸‹è½½ä¸‹æ¥åï¼Œé…ç½®å¥½URIï¼Œå°±ä¼šæç¤ºè¦è®¿é—®æŸæŸåº”ç”¨çš„åˆ‡ç‰‡æƒé™æç¤ºï¼Œç‚¹å‡»ç¡®å®šå°±å¯ä»¥çœ‹åˆ°åˆ‡ç‰‡å†…å®¹äº†ï¼ˆæ³¨æ„æœ€å¥½ä½¿ç”¨æ¨¡æ‹Ÿå™¨æµ‹è¯•ï¼ŒçœŸæœºæœ‰å¯èƒ½æ— æ³•å¼¹å‡ºåˆ‡ç‰‡æƒé™å¼¹çª—ï¼‰ã€‚å¦‚ä¸‹å›¾ï¼Œç‚¹å‡»helloå°±å¯ä»¥è·³è½¬åˆ°æˆ‘ä»¬ä¹‹å‰`createActivityAction`æ–¹æ³•é‡Œé¢è®¾ç½®çš„Activityäº†ã€‚

![img](https:////upload-images.jianshu.io/upload_images/8690467-3cf49b0c9aa098bc.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/385/format/webp)

slice.jpg

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Fslices)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fslice)

### Jetpack-ç•Œé¢ç»„ä»¶

#### åŠ¨ç”»å’Œè¿‡æ¸¡

> å½“ç•Œé¢å› å“åº”ç”¨æˆ·æ“ä½œè€Œå‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‚¨åº”ä¸ºå¸ƒå±€è¿‡æ¸¡æ·»åŠ åŠ¨ç”»ã€‚è¿™äº›åŠ¨ç”»å¯å‘ç”¨æˆ·æä¾›æœ‰å…³å…¶æ“ä½œçš„åé¦ˆï¼Œå¹¶æœ‰åŠ©äºè®©ç”¨æˆ·å§‹ç»ˆå…³æ³¨ç•Œé¢ã€‚

åŠ¨ç”»ä¹Ÿæ˜¯è€ç”Ÿå¸¸è°ˆçš„å†…å®¹äº†ã€‚è¯´åˆ°åŠ¨ç”»ï¼Œæˆ‘ä»¬éƒ½ä¼šæƒ³åˆ°`å¸§åŠ¨ç”»ï¼Œå±æ€§åŠ¨ç”»ï¼Œè¡¥é—´åŠ¨ç”»`ç­‰ç­‰ã€‚ä»Šå¤©æˆ‘ä»¬ä»ä¸ä¸€æ ·çš„è§’åº¦å½’ç±»ä¸€äº›é‚£äº›ä½ ç†Ÿæ‚‰åˆä¸ç†Ÿæ‚‰çš„åŠ¨ç”»ã€‚

1ï¼‰**ä¸ºä½å›¾æ·»åŠ åŠ¨ç”»**

- `AnimationDrawable`ã€‚æ¥è¿åŠ è½½ä¸€ç³»åˆ—å¯ç»˜åˆ¶èµ„æºä»¥åˆ›å»ºåŠ¨ç”»ã€‚å³å±æ€§åŠ¨ç”»ï¼Œé€šè¿‡è®¾ç½®æ¯å¸§çš„å›¾åƒï¼Œå½¢æˆåŠ¨ç”»ã€‚
- `AnimatedVectorDrawable`ã€‚ä¸ºçŸ¢é‡å¯ç»˜åˆ¶å¯¹è±¡çš„å±æ€§æ·»åŠ åŠ¨ç”»æ•ˆæœï¼Œä¾‹å¦‚æ—‹è½¬æˆ–æ›´æ”¹è·¯å¾„æ•°æ®ä»¥å°†å…¶å˜ä¸ºå…¶ä»–å›¾ç‰‡ã€‚

å…¶ä¸­ä¸»è¦è®²ä¸‹`AnimatedVectorDrawableï¼ŒVectorDrawable`æ˜¯ä¸ºäº†æ”¯æŒSVGè€Œç”Ÿï¼ŒSVG æ˜¯å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ï¼Œç”¨xmlä»£ç æç»˜å›¾åƒã€‚ä¸‹é¢ä¸¾ä¸ªğŸŒ°



```kotlin
//res-drawable-vectordrawable.xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:height="64dp"
    android:width="64dp"
    android:viewportHeight="600"
    android:viewportWidth="600">
    <group
        android:name="rotationGroup"
        android:pivotX="300.0"
        android:pivotY="300.0"
        android:rotation="45.0" >
        <path
            android:name="v"
            android:fillColor="#000000"
            android:pathData="M300,70 l 0,-70 70,70 0,0 -70,70z" />
    </group>
</vector>

//res-animator-path_morph.xml
<?xml version="1.0" encoding="utf-8"?>
<set xmlns:android="http://schemas.android.com/apk/res/android">
    <objectAnimator
        android:duration="3000"
        android:propertyName="pathData"
        android:valueFrom="M300,70 l 0,-70 70,70 0,0   -70,70z"
        android:valueTo="M300,70 l 0,-70 70,0  0,140 -70,0 z"
        android:valueType="pathType" />
</set>

//res-animator-rotation.xml
<?xml version="1.0" encoding="utf-8"?>
<objectAnimator xmlns:android="http://schemas.android.com/apk/res/android"
    android:duration="6000"
    android:propertyName="rotation"
    android:valueFrom="0"
    android:valueTo="360" />


//åˆ©ç”¨ä¸Šé¢ä¸¤ä¸ªåŠ¨ç”»æ–‡ä»¶å’Œä¸€ä¸ªSVGå›¾åƒï¼Œç”Ÿæˆanimated-vectorå¯æ‰§è¡ŒåŠ¨ç”»
//res-drawable-animatiorvectordrawable.xml
<?xml version="1.0" encoding="utf-8"?>
<animated-vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:drawable="@drawable/vectordrawable" >
    <target
        android:name="rotationGroup"
        android:animation="@animator/rotation" />
    <target
        android:name="v"
        android:animation="@animator/path_morph" />
</animated-vector>


//å¸ƒå±€æ–‡ä»¶activity_vector.xml
    <ImageView
        android:id="@+id/imageView"
        android:layout_width="match_parent"
        android:layout_height="200dp"
        app:srcCompat="@drawable/animatorvectordrawable"
        app:layout_constraintTop_toTopOf="parent"
        />
        
//activity
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_vector)
        imageView.setOnClickListener {
            (imageView.drawable as Animatable).start()
        }
    }
```

okï¼Œè¿è¡Œåï¼Œç‚¹å‡»å›¾åƒï¼Œå°±ä¼šå‘ç°ä¸€ä¸ªç»•åœˆçš„åŒæ—¶åˆä¼šè‡ªå˜çš„åŠ¨ç”»äº†ï¼Œæ„Ÿè§‰æœ‰ç‚¹åƒåœ°çƒè‡ªè½¬å’Œå…¬è½¬ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å®ç°ä¸‹ã€‚

2ï¼‰**ä¸ºç•Œé¢å¯è§æ€§å’ŒåŠ¨ä½œæ·»åŠ åŠ¨ç”»**
 è¿™ä¸€éƒ¨åˆ†ä¸»è¦å°±æ˜¯å±æ€§åŠ¨ç”»ã€‚å±æ€§åŠ¨ç”»çš„åŸç†å°±æ˜¯åœ¨ä¸€æ®µæ—¶é—´å†…æ›´æ–° View å¯¹è±¡çš„å±æ€§ï¼Œå¹¶éšç€å±æ€§çš„å˜åŒ–ä¸æ–­åœ°é‡æ–°ç»˜åˆ¶è§†å›¾ã€‚ä¹Ÿå°±æ˜¯`ValueAnimator`ï¼Œä»¥åŠåœ¨æ­¤æŠ€æœ¯ä¸Šè¡ç”Ÿçš„`ViewPropertyAnimator` å’Œ `ObjectAnimator`ã€‚ä¸»è¦è¿ç”¨åˆ°æ§ä»¶æœ¬èº«çš„åŸºç¡€åŠ¨ç”»ä»¥åŠè‡ªå®šä¹‰viewåŠ¨ç”»ã€‚

3ï¼‰**åŸºäºç‰©ç†ç‰¹æ€§çš„åŠ¨ä½œ**
 è¿™éƒ¨åˆ†å¯ä»¥è®©åŠ¨ç”»åº”å°½å¯èƒ½è¿ç”¨ç°å®ä¸–ç•Œçš„ç‰©ç†å®šå¾‹ï¼Œä»¥ä½¿å…¶çœ‹èµ·æ¥æ›´è‡ªç„¶ã€‚æ¯”å¦‚å¼¹ç°§åŠ¨ç”»å’ŒæŠ•æ·åŠ¨ç”»ã€‚è¿™é‡Œä¸¾ä¸ªå¼¹ç°§åŠ¨ç”»çš„ğŸŒ°



```kotlin
    def dynamicanimation_version = "1.0.0"
    implementation "androidx.dynamicanimation:dynamicanimation:$dynamicanimation_version"

        val springForce = SpringForce(0.0f)
            .setDampingRatio(0f)  //è®¾ç½®é˜»å°¼
            .setStiffness(0.5f)  //è®¾ç½®åˆšåº¦

        imageView2.setOnClickListener {
            SpringAnimation(imageView2, DynamicAnimation.TRANSLATION_Y).apply {
                spring = springForce
                setStartVelocity(500f) //è®¾ç½®é€Ÿåº¦
                start()
            }
        }
```

4ï¼‰**ä¸ºå¸ƒå±€æ›´æ”¹æ·»åŠ åŠ¨ç”»**
 å€ŸåŠ© Android çš„è¿‡æ¸¡æ¡†æ¶ï¼Œæ‚¨åªéœ€æä¾›`èµ·å§‹å¸ƒå±€å’Œç»“æŸå¸ƒå±€`ï¼Œå³å¯ä¸ºç•Œé¢ä¸­çš„å„ç§è¿åŠ¨æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦æä¾›ä¸¤ä¸ªåœºæ™¯ï¼Œä»£è¡¨åŠ¨ç”»å‰åï¼Œç„¶åå°±å¯ä»¥è‡ªåŠ¨ç”ŸæˆåŠ¨ç”»äº†ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤ä¸ªåœºæ™¯å…¶å®åœ¨ä¸€ä¸ªé¡µé¢ä¸­ã€‚



```kotlin
//ä¸¤ä¸ªåœºæ™¯çš„å¸ƒå±€
    <FrameLayout
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@+id/scene_root">

        <include layout="@layout/a_scene" />
    </FrameLayout>
    
//åœºæ™¯ä¸€
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/scene_container"
    android:layout_width="match_parent"
    android:layout_height="match_parent" >
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textSize="26sp"
        android:id="@+id/text_view1"
        android:text="Text Line 1" />
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textSize="26sp"
        android:id="@+id/text_view2"
        android:text="Text Line 2" />
</LinearLayout>

//åœºæ™¯äºŒ
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/scene_container"
    android:layout_width="match_parent"
    android:layout_height="match_parent" >
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@+id/text_view2"
        android:textSize="22sp"
        android:text="Text Line 2" />
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textSize="22sp"
        android:id="@+id/text_view1"
        android:text="Text Line 1" />
</LinearLayout>

//è·å–åœºæ™¯ï¼Œå¼€å§‹åœºæ™¯é—´çš„åŠ¨ç”»ï¼Œä»åœºæ™¯ä¸€å˜åŒ–ä¸ºåœºæ™¯äºŒ

        val sceneRoot: ViewGroup = findViewById(R.id.scene_root)
        val aScene: Scene = Scene.getSceneForLayout(sceneRoot, R.layout.a_scene, this)
        val anotherScene: Scene = Scene.getSceneForLayout(sceneRoot, R.layout.another_scene, this)

        titletv.setOnClickListener {
            TransitionManager.go(anotherScene)
        }
```

5ï¼‰**åœ¨ `Activity` ä¹‹é—´æ·»åŠ åŠ¨ç”»**
 åˆšæ‰æ˜¯åŒä¸€é¡µé¢ä¸åŒåœºæ™¯ä¹‹é—´çš„åŠ¨ç”»ï¼Œå¦‚æœæ˜¯ä¸åŒé¡µé¢å‘¢ï¼Ÿä¹Ÿå°±æ˜¯ä¸åŒçš„Activityä¹‹é—´çš„åŠ¨ç”»å‘¢ï¼Ÿæ›´ç®€å•äº†å“ˆå“ˆï¼Œå¯ä»¥åœ¨`style`ä¸­è®¾ç½®å…·ä½“çš„åŠ¨ç”»ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è®¾ç½®è¿‡æ¸¡åŠ¨ç”»ï¼Œè¿˜å¯ä»¥è®¾ç½®`å…±äº«æ§ä»¶`å®Œæˆè¿‡æ¸¡åŠ¨ç”»ã€‚



```kotlin
//æ ·å¼ä¸­å®šä¹‰åŠ¨ç”»
      <item name="android:windowEnterTransition">@transition/explode</item>
      <item name="android:windowExitTransition">@transition/explode</item>
    

//è®¾ç½®è¿‡æ¸¡åŠ¨ç”»ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªå¸ƒå±€ä¸­è®¾ç½®å…±äº«æ§ä»¶ï¼Œandroid:transitionName="robot"
        val intent = Intent(this, Activity2::class.java)
        // create the transition animation - the images in the layouts
        // of both activities are defined with android:transitionName="robot"
        val options = ActivityOptions
                .makeSceneTransitionAnimation(this, androidRobotView, "robot")
        // start the new activity
        startActivity(intent, options.toBundle())
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftraining%2Fanimation)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fanimation)

#### è¡¨æƒ…ç¬¦å·

> EmojiCompat æ”¯æŒåº“æ—¨åœ¨è®© Android è®¾å¤‡åŠæ—¶å…¼å®¹æœ€æ–°çš„è¡¨æƒ…ç¬¦å·ã€‚å®ƒå¯é˜²æ­¢æ‚¨çš„åº”ç”¨ä»¥ â˜ çš„å½¢å¼æ˜¾ç¤ºç¼ºå°‘çš„è¡¨æƒ…ç¬¦å·å­—ç¬¦ï¼Œè¯¥ç¬¦å·è¡¨ç¤ºæ‚¨çš„è®¾å¤‡æ²¡æœ‰ç”¨äºæ˜¾ç¤ºæ–‡å­—çš„ç›¸åº”å­—ä½“ã€‚é€šè¿‡ä½¿ç”¨ EmojiCompat æ”¯æŒåº“ï¼Œæ‚¨çš„åº”ç”¨ç”¨æˆ·æ— éœ€ç­‰åˆ° Android OS æ›´æ–°å³å¯è·å–æœ€æ–°çš„è¡¨æƒ…ç¬¦å·ã€‚

è¿™ä¸€æ¨¡å—å°±æ˜¯ä¸ºäº†å…¼å®¹æ€§æä¾›çš„ä¸€ä¸ªåº“ï¼š`EmojiCompat`ï¼Œé€šè¿‡CharSequenceæ–‡æœ¬ä¸­çš„ emoji å¯¹åº”çš„`unicode ç¼–ç `æ¥è¯†åˆ« emoji è¡¨æƒ…ï¼Œå°†ä»–ä»¬æ›¿æ¢æˆEmojiSpansï¼Œæœ€åå‘ˆç° emoji è¡¨æƒ…ç¬¦å·ã€‚

![img](https:////upload-images.jianshu.io/upload_images/8690467-fa89e1d599063d64.png?imageMogr2/auto-orient/strip|imageView2/2/w/600/format/webp)

emoji.png



```kotlin
//å¯¼å…¥åº“
implementation "com.android.support:support-emoji:28.0.0"

//åˆå§‹åŒ–
EmojiCompat.Config config = new BundledEmojiCompatConfig(this);
EmojiCompat.init(config);
       
//æ›¿æ¢ç»„ä»¶
<android.support.text.emoji.widget.EmojiTextView
   android:layout_width="wrap_content"
   android:layout_height="wrap_content"/>  
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Ftopics%2Fui%2Flook-and-feel%2Femoji-compat)

#### Fragment

> Fragment è¡¨ç¤º FragmentActivity ä¸­çš„è¡Œä¸ºæˆ–ç•Œé¢çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥åœ¨ä¸€ä¸ª Activity ä¸­ç»„åˆå¤šä¸ªç‰‡æ®µï¼Œä»è€Œæ„å»ºå¤šçª—æ ¼ç•Œé¢ï¼Œå¹¶åœ¨å¤šä¸ª Activity ä¸­é‡å¤ä½¿ç”¨æŸä¸ªç‰‡æ®µã€‚æ‚¨å¯ä»¥å°†ç‰‡æ®µè§†ä¸º Activity çš„æ¨¡å—åŒ–ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå…·æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œèƒ½æ¥æ”¶è‡ªå·±çš„è¾“å…¥äº‹ä»¶ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥åœ¨ Activity è¿è¡Œæ—¶æ·»åŠ æˆ–ç§»é™¤ç‰‡æ®µï¼ˆè¿™æœ‰ç‚¹åƒå¯ä»¥åœ¨ä¸åŒ Activity ä¸­é‡å¤ä½¿ç”¨çš„â€œå­ Activityâ€ï¼‰ã€‚
>  ç‰‡æ®µå¿…é¡»å§‹ç»ˆæ‰˜ç®¡åœ¨ Activity ä¸­ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç›´æ¥å—å®¿ä¸» Activity ç”Ÿå‘½å‘¨æœŸçš„å½±å“ã€‚

æˆ‘ç¡®å®æ²¡æƒ³åˆ°`fragment`ä¹Ÿè¢«å½’å…¥åˆ°jetpackäº†ï¼Œå“ˆå“ˆï¼Œè¿™é‡Œæˆ‘å°±è´´ä¸€ç¯‡[æˆ‘è§‰å¾—å†™å¾—å¥½çš„æ–‡ç« ](https://www.jianshu.com/p/d9143a92ad94)ï¼Œè™½ç„¶æ–‡ç« æ¯”è¾ƒè€äº†ï¼Œä½†æ˜¯å¯ä»¥å¸®ä½ æ›´æ·±ç†è§£`Fragment`ã€‚
 å½“ç„¶å®˜æ–¹ä¹Ÿå‘å¸ƒäº†Fragmentçš„ç®¡ç†æ¡†æ¶â€”â€”`Navigation`ï¼Œæ„Ÿå…´è¶£çš„åœ¨æœ¬æ–‡æœç´¢ä¸‹å³å¯ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Fcomponents%2Ffragments)

#### å¸ƒå±€

> å¸ƒå±€å¯å®šä¹‰åº”ç”¨ä¸­çš„ç•Œé¢ç»“æ„ï¼ˆä¾‹å¦‚ Activity çš„ç•Œé¢ç»“æ„ï¼‰ã€‚å¸ƒå±€ä¸­çš„æ‰€æœ‰å…ƒç´ å‡ä½¿ç”¨ View å’Œ ViewGroup å¯¹è±¡çš„å±‚æ¬¡ç»“æ„è¿›è¡Œæ„å»ºã€‚View é€šå¸¸ç»˜åˆ¶ç”¨æˆ·å¯æŸ¥çœ‹å¹¶è¿›è¡Œäº¤äº’çš„å†…å®¹ã€‚ç„¶è€Œï¼ŒViewGroup æ˜¯ä¸å¯è§å®¹å™¨ï¼Œç”¨äºå®šä¹‰ View å’Œå…¶ä»– ViewGroup å¯¹è±¡çš„å¸ƒå±€ç»“æ„

å¸ƒå±€éƒ¨åˆ†ä¸»è¦æ³¨æ„ä¸‹æ¯”è¾ƒæ–°çš„ä¸¤ä¸ªå¸ƒå±€`ConstraintLayout`å’Œ`MotionLayout`ã€‚

- `ConstraintLayout`ç°åœ¨ç”¨çš„å·²ç»å¾ˆå¤šäº†ï¼Œç¡®å®å¾ˆå¥½ç”¨ï¼Œç‰¹åˆ«æ˜¯å¤æ‚çš„å¤§å‹å¸ƒå±€ï¼Œä¸RelativeLayoutå±å…³ç³»å¸ƒå±€ï¼Œä½†æ˜¯æ›´åŠ çµæ´»ï¼Œä¹Ÿå¯ä»¥é…åˆAndroid Studioçš„å¸ƒå±€ç¼–è¾‘å™¨ä½¿ç”¨ï¼Œå…·ä½“ç”¨æ³•è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œè´´ä¸Š[å®˜ç½‘é“¾æ¥](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftraining%2Fconstraint-layout)ã€‚
- `MotionLayout` æ˜¯ä¸€ç§å¸ƒå±€ç±»å‹ï¼Œå¯å¸®åŠ©æ‚¨ç®¡ç†åº”ç”¨ä¸­çš„è¿åŠ¨å’Œå¾®ä»¶åŠ¨ç”»ã€‚MotionLayoutæ˜¯ `ConstraintLayout` çš„å­ç±»ï¼Œåœ¨å…¶ä¸°å¯Œçš„å¸ƒå±€åŠŸèƒ½åŸºç¡€ä¹‹ä¸Šæ„å»ºè€Œæˆã€‚

æ‰€ä»¥`MotionLayout`å°±æ˜¯å¸¦åŠ¨ç”»çš„ConstraintLayoutå‘—ï¼Œè¿™é‡Œä¸¾ä¸ªğŸŒ°çœ‹çœ‹æ•ˆæœï¼š



```kotlin
   implementation 'androidx.constraintlayout:constraintlayout:2.0.0-beta8'

<androidx.constraintlayout.motion.widget.MotionLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/motionLayout"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    app:layoutDescription="@xml/scene_01"
    tools:showPaths="true">

    <View
        android:id="@+id/button"
        android:layout_width="64dp"
        android:layout_height="64dp"
        android:background="@color/colorAccent"
        android:text="Button" />

</androidx.constraintlayout.motion.widget.MotionLayout>


//scene_01.xml
<?xml version="1.0" encoding="utf-8"?>
<MotionScene xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:motion="http://schemas.android.com/apk/res-auto">

    <Transition
        motion:constraintSetStart="@+id/start"
        motion:constraintSetEnd="@+id/end"
        motion:duration="1000">
        <OnSwipe
            motion:touchAnchorId="@+id/button"
            motion:touchAnchorSide="right"
            motion:dragDirection="dragRight" />
    </Transition>

    <ConstraintSet android:id="@+id/start">
        <Constraint
            android:id="@+id/button"
            android:layout_width="64dp"
            android:layout_height="64dp"
            android:layout_marginStart="8dp"
            motion:layout_constraintBottom_toBottomOf="parent"
            motion:layout_constraintStart_toStartOf="parent"
            motion:layout_constraintTop_toTopOf="parent" >

            <CustomAttribute
                motion:attributeName="backgroundColor"
                motion:customColorValue="#D81B60" />
        </Constraint>
    </ConstraintSet>

    <ConstraintSet android:id="@+id/end">
        <Constraint
            android:id="@+id/button"
            android:layout_width="64dp"
            android:layout_height="64dp"
            android:layout_marginEnd="8dp"
            motion:layout_constraintBottom_toBottomOf="parent"
            motion:layout_constraintEnd_toEndOf="parent"
            motion:layout_constraintTop_toTopOf="parent" >

            <CustomAttribute
                motion:attributeName="backgroundColor"
                motion:customColorValue="#9999FF" />
        </Constraint>
    </ConstraintSet>

</MotionScene>
```

è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š



![img](https:////upload-images.jianshu.io/upload_images/8690467-0001a71f6bc281b6.gif?imageMogr2/auto-orient/strip|imageView2/2/w/718/format/webp)

motionlayout.gif

ä¸»è¦æ˜¯é€šè¿‡`app:layoutDescription="@xml/scene_01"`è®¾å®šåŠ¨ç”»åœºæ™¯ï¼Œç„¶ååœ¨scene_01åœºæ™¯ä¸­å°±å¯ä»¥è®¾ç½®èµ·å§‹å’Œç»“æŸä½ç½®ï¼ŒåŠ¨ç”»å±æ€§ï¼Œå°±å¯ä»¥å®Œæˆå¯¹åŠ¨ç”»çš„è®¾ç½®äº†ã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹`è‡ªå®šä¹‰view`é‚£å‘³äº†ï¼Œå…³é”®è¿™ä¸ªåªéœ€è¦å¸ƒå±€ä¸€ä¸ªxmlæ–‡ä»¶å°±å¯ä»¥äº†ï¼è¿˜ä¸è¯•è¯•ï¼Ÿ

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Ftopics%2Fui%2Fdeclaring-layout)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fmotionlayout)

#### è°ƒè‰²æ¿

> å‡ºè‰²çš„è§†è§‰è®¾è®¡æ˜¯åº”ç”¨æˆåŠŸçš„å…³é”®æ‰€åœ¨ï¼Œè€Œé…è‰²æ–¹æ¡ˆæ˜¯è®¾è®¡çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚è°ƒè‰²æ¿åº“æ˜¯ä¸€ä¸ªæ”¯æŒåº“ï¼Œç”¨äºä»å›¾ç‰‡ä¸­æå–çªå‡ºé¢œè‰²ï¼Œå¸®åŠ©æ‚¨åˆ›å»ºå…·æœ‰è§†è§‰å¸å¼•åŠ›çš„åº”ç”¨ã€‚

æ²¡æƒ³åˆ°å§ï¼ŒAndroidè¿˜æœ‰å®˜æ–¹çš„è°ƒè‰²æ¿åº“â€”`Palette`ã€‚é‚£åˆ°åº•è¿™ä¸ªè°ƒè‰²æ¿èƒ½åšä»€ä¹ˆå‘¢ï¼Ÿä¸»è¦ç”¨æ¥åˆ†æå›¾ç‰‡ä¸­çš„`è‰²å½©ç‰¹æ€§`ã€‚æ¯”å¦‚å›¾ç‰‡ä¸­çš„æš—è‰²ï¼Œäº®è‰²ï¼Œé²œè‰³é¢œè‰²ï¼ŒæŸ”å’Œè‰²ï¼Œæ–‡å­—é¢œè‰²ï¼Œä¸»è‰²è°ƒï¼Œç­‰ç­‰ã€‚



```kotlin
   implementation 'com.android.support:palette-v7:28.0.0'

    //åŒæ­¥åˆ†æå›¾ç‰‡å¹¶è·å–å®ä¾‹
    fun createPaletteSync(bitmap: Bitmap): Palette = Palette.from(bitmap).generate()

   //å¼‚æ­¥åˆ†æå›¾ç‰‡å¹¶è·å–å®ä¾‹
    fun createPaletteAsync(bitmap: Bitmap) {
        Palette.from(bitmap).generate { palette ->
            // Use generated instance
        val mutedColor = palette!!.getMutedColor(Color.BLUE)
        //ä¸»è‰²è°ƒ
        val rgb: Int? = palette?.vibrantSwatch?.rgb
        //æ–‡å­—é¢œè‰²
        val bodyTextColor: Int? = palette?.vibrantSwatch?.bodyTextColor
        //æ ‡é¢˜çš„é¢œè‰²
        val titleTextColor: Int? = palette?.vibrantSwatch?.titleTextColor 
        }
    }
    
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftraining%2Fmaterial%2Fpalette-colors)      
 [Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fpalette)

### æ€»ç»“

ç»ˆäºå‘Šä¸€æ®µè½äº†ï¼Œå¤§å®¶åƒğŸŒ°åº”è¯¥åƒé¥±äº†å§å“ˆå“ˆã€‚
 å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½è®©ä¸æ€ä¹ˆç†Ÿæ‚‰`Jetpack`çš„åŒå­¦å¤šäº†è§£äº†è§£ã€‚
 å½“ç„¶ï¼Œè¿™è¿˜è¿œè¿œä¸å¤Ÿï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œæœ¬æ–‡æ›´åƒæ˜¯ä¸€ä¸ª`ç§‘æ™®æ–‡`ï¼Œåªæ˜¯å‘Šè¯‰äº†å¤§å®¶jetpackå¤§å®¶åº­æœ‰å“ªäº›æˆå‘˜ï¼Œæœ‰ä»€ä¹ˆç”¨å¤„ã€‚å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»ºç«‹`MVVM`çš„æ€æƒ³ï¼Œæ·±åˆ»äº†è§£æ¯ä¸ªç»„ä»¶çš„è®¾è®¡æ„ä¹‰ï¼Œçµæ´»è¿ç”¨ç»„ä»¶ã€‚å¦‚æœå¤§å®¶æ„Ÿå…´è¶£ï¼Œåé¢æˆ‘ä¼šå®Œæ•´åšä¸€ä¸ªMVVMçš„é¡¹ç›®ï¼Œå¹¶é€šè¿‡æ–‡ç« çš„å½¢å¼è®°å½•æ•´ä¸ªè¿‡ç¨‹ã€‚ï¼ˆé™„ä»¶ä¹Ÿæœ‰ä¸€ä¸ªé¡¹ç›®æ˜¯å®˜æ–¹çš„`Jetpackå®è·µé¡¹ç›®`ï¼‰
 æœ€åå¸Œæœ›å¤§å®¶éƒ½èƒ½é€šè¿‡`jetpack`æ„å»ºé«˜è´¨é‡ï¼Œç®€æ˜“å¹¶ä¼˜è´¨çš„é¡¹ç›®æ¶æ„ï¼Œä»è€Œè§£æ”¾ç”Ÿäº§åŠ›ï¼Œæˆä¸º`æ•ˆç‡è¾¾äºº`ã€‚

### é™„ä»¶ï¼š

[Jetpackå®è·µå®˜æ–¹Demoâ€”Sunflower](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fandroid%2Fsunflower)      
 [æ–‡ç« ç›¸å…³æ‰€æœ‰Demo](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo)



ä½œè€…ï¼šç§¯æœ¨zz
é“¾æ¥ï¼šhttps://www.jianshu.com/p/f22e1f64c505
æ¥æºï¼šç®€ä¹¦
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚